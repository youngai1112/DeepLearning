(function(He){"use strict";var _n=Object.defineProperty,In=(t,e)=>_n(t,"name",{value:e,configurable:!0});function Ct(t){var e,r;const n=(r=(e=t.head)==null?void 0:e.querySelector('meta[name="expected-hostname"]'))==null?void 0:r.content;if(!n)return!1;const i=n.replace(/\.$/,"").split(".").slice(-2).join("."),o=t.location.hostname.replace(/\.$/,"").split(".").slice(-2).join(".");return i!==o}In(Ct,"detectProxySite");let Ye;function Vt(){return`${Math.round(Math.random()*(Math.pow(2,31)-1))}.${Math.round(Date.now()/1e3)}`}function yn(t){const e=`GH1.1.${t}`,r=Date.now(),n=new Date(r+1*365*86400*1e3).toUTCString();let{domain:i}=document;i.endsWith(".github.com")&&(i="github.com"),document.cookie=`_octo=${e}; expires=${n}; path=/; domain=${i}; secure; samesite=lax`}function mn(){let t;const r=document.cookie.match(/_octo=([^;]+)/g);if(!r)return;let n=[0,0];for(const i of r){const[,o]=i.split("="),[,a,...u]=o.split("."),s=a.split("-").map(Number);s>n&&(n=s,t=u.join("."))}return t}function q(){try{const t=mn();if(t)return t;const e=Vt();return yn(e),e}catch{return Ye||(Ye=Vt()),Ye}}function Rn(){return"abort"in AbortSignal&&typeof AbortSignal.abort=="function"}function On(){return"abort"in AbortSignal&&typeof AbortSignal.timeout=="function"}function Tn(){return typeof globalThis.AggregateError=="function"}const Pt=Reflect.getPrototypeOf(Int8Array)||{};function Nn(){return"at"in Array.prototype&&typeof Array.prototype.at=="function"&&"at"in String.prototype&&typeof String.prototype.at=="function"&&"at"in Pt&&typeof Pt.at=="function"}function An(){return typeof crypto=="object"&&"randomUUID"in crypto&&typeof crypto.randomUUID=="function"}function Sn(){let t=!1;const e=()=>t=!0;function r(){}const n=Object.create({},{signal:{get:e}});try{const i=new EventTarget;return i.addEventListener("test",r,n),i.removeEventListener("test",r,n),t}catch{return t}}function Ln(){return"hasOwn"in Object&&typeof Object.hasOwn=="function"}function Dn(){return"any"in Promise&&typeof Promise.any=="function"}function Un(){return typeof globalThis.requestIdleCallback=="function"}const bn=typeof Blob=="function"&&typeof PerformanceObserver=="function"&&typeof Intl=="object"&&typeof MutationObserver=="function"&&typeof URLSearchParams=="function"&&typeof WebSocket=="function"&&typeof IntersectionObserver=="function"&&typeof queueMicrotask=="function"&&typeof TextEncoder=="function"&&typeof TextDecoder=="function"&&typeof customElements=="object"&&typeof HTMLDetailsElement=="function"&&typeof AbortController=="function"&&typeof AbortSignal=="function"&&"entries"in FormData.prototype&&"toggleAttribute"in Element.prototype&&"replaceChildren"in Element.prototype&&"fromEntries"in Object&&"flatMap"in Array.prototype&&"trimEnd"in String.prototype&&"allSettled"in Promise&&"matchAll"in String.prototype&&"replaceAll"in String.prototype&&!0;function Cn(){return bn&&Rn()&&On()&&Tn()&&Nn()&&An()&&Sn()&&Ln()&&Dn()&&Un()}var ue="<unknown>";function Vn(t){var e=t.split(`
`);return e.reduce(function(r,n){var i=Fn(n)||kn(n)||Kn(n)||Yn(n)||Gn(n);return i&&r.push(i),r},[])}var Pn=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,Mn=/\((\S*)(?::(\d+))(?::(\d+))\)/;function Fn(t){var e=Pn.exec(t);if(!e)return null;var r=e[2]&&e[2].indexOf("native")===0,n=e[2]&&e[2].indexOf("eval")===0,i=Mn.exec(e[2]);return n&&i!=null&&(e[2]=i[1],e[3]=i[2],e[4]=i[3]),{file:r?null:e[2],methodName:e[1]||ue,arguments:r?[e[2]]:[],lineNumber:e[3]?+e[3]:null,column:e[4]?+e[4]:null}}var xn=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i;function kn(t){var e=xn.exec(t);return e?{file:e[2],methodName:e[1]||ue,arguments:[],lineNumber:+e[3],column:e[4]?+e[4]:null}:null}var wn=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,Bn=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i;function Kn(t){var e=wn.exec(t);if(!e)return null;var r=e[3]&&e[3].indexOf(" > eval")>-1,n=Bn.exec(e[3]);return r&&n!=null&&(e[3]=n[1],e[4]=n[2],e[5]=null),{file:e[3],methodName:e[1]||ue,arguments:e[2]?e[2].split(","):[],lineNumber:e[4]?+e[4]:null,column:e[5]?+e[5]:null}}var jn=/^\s*(?:([^@]*)(?:\((.*?)\))?@)?(\S.*?):(\d+)(?::(\d+))?\s*$/i;function Gn(t){var e=jn.exec(t);return e?{file:e[3],methodName:e[1]||ue,arguments:[],lineNumber:+e[4],column:e[5]?+e[5]:null}:null}var Hn=/^\s*at (?:((?:\[object object\])?[^\\/]+(?: \[as \S+\])?) )?\(?(.*?):(\d+)(?::(\d+))?\)?\s*$/i;function Yn(t){var e=Hn.exec(t);return e?{file:e[2],methodName:e[1]||ue,arguments:[],lineNumber:+e[3],column:e[4]?+e[4]:null}:null}var qn=Object.defineProperty,Ie=(t,e)=>qn(t,"name",{value:e,configurable:!0});function ye(t){const e=document.querySelectorAll(t);if(e.length>0)return e[e.length-1]}Ie(ye,"queryLast");function Mt(){const t=ye("meta[name=analytics-location]");return t?t.content:window.location.pathname}Ie(Mt,"pagePathname");function Ft(){const t=ye("meta[name=analytics-location-query-strip]");let e="";t||(e=window.location.search);const r=ye("meta[name=analytics-location-params]");r&&(e+=(e?"&":"?")+r.content);for(const n of document.querySelectorAll("meta[name=analytics-param-rename]")){const i=n.content.split(":",2);e=e.replace(new RegExp(`(^|[?&])${i[0]}($|=)`,"g"),`$1${i[1]}$2`)}return e}Ie(Ft,"pageQuery");function qe(){return`${window.location.protocol}//${window.location.host}${Mt()+Ft()}`}Ie(qe,"requestUri");var $n=Object.defineProperty,B=(t,e)=>$n(t,"name",{value:e,configurable:!0});let xt=!1,kt=0;const zn=Date.now();function Xn(t){t.error&&me(Oe(Re(t.error)))}B(Xn,"reportEvent");async function Wn(t){if(!!t.promise)try{await t.promise}catch(e){me(Oe(Re(e)))}}B(Wn,"reportPromiseRejectionEvent");function wt(t,e={}){t&&t.name!=="AbortError"&&me(Oe(Re(t),e))}B(wt,"reportError");async function me(t){var e,r;if(!jt())return;const n=(r=(e=document.head)==null?void 0:e.querySelector('meta[name="browser-errors-url"]'))==null?void 0:r.content;if(!!n){if(Kt(t.error.stacktrace)){xt=!0;return}kt++;try{await fetch(n,{method:"post",body:JSON.stringify(t)})}catch{}}}B(me,"report");function Re(t){return{type:t.name,value:t.message,stacktrace:$e(t)}}B(Re,"formatError");function Oe(t,e={}){return Object.assign({error:t,sanitizedUrl:qe()||window.location.href,readyState:document.readyState,referrer:document.referrer,timeSinceLoad:Math.round(Date.now()-zn),user:ze()||void 0,bundler:Gt()},e)}B(Oe,"errorContext");function $e(t){return Vn(t.stack||"").map(e=>({filename:e.file||"",function:String(e.methodName),lineno:(e.lineNumber||0).toString(),colno:(e.column||0).toString()}))}B($e,"stacktrace");const Bt=/(chrome|moz|safari)-extension:\/\//;function Kt(t){return t.some(e=>Bt.test(e.filename)||Bt.test(e.function))}B(Kt,"isExtensionError");function ze(){var t,e;const r=(e=(t=document.head)==null?void 0:t.querySelector('meta[name="user-login"]'))==null?void 0:e.content;return r||`anonymous-${q()}`}B(ze,"pageUser");let Xe=!1;window.addEventListener("pageshow",()=>Xe=!1),window.addEventListener("pagehide",()=>Xe=!0);function jt(){return!Xe&&!xt&&kt<10&&Cn()&&!Ct(document)}B(jt,"reportable");function Gt(){return"System"in window?"rollup":"webpack"}B(Gt,"bundlerName"),typeof BroadcastChannel=="function"&&new BroadcastChannel("shared-worker-error").addEventListener("message",e=>{wt(e.data.error)});var T=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Jn(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach(function(r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}),e}var O={},J={};Object.defineProperty(J,"__esModule",{value:!0});var We=function(){function t(){}return t.prototype.handleError=function(e){},t}();J.NoopErrorHandler=We;var Je=new We;function Zn(t){Je=t}J.setErrorHandler=Zn;function Qn(){return Je}J.getErrorHandler=Qn;function ei(){Je=new We}J.resetErrorHandler=ei;var Ze={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NOTSET=0]="NOTSET",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARNING=3]="WARNING",e[e.ERROR=4]="ERROR"}(t.LogLevel||(t.LogLevel={}))})(Ze);var $={},I={},ti=Object.defineProperty,ri=(t,e)=>ti(t,"name",{value:e,configurable:!0});function Ht(){return crypto.randomUUID()}ri(Ht,"v4");var ni=Object.freeze({__proto__:null,v4:Ht}),ii=Jn(ni);(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ii;function r(){return e.v4()}t.generateUUID=r;function n(){return new Date().getTime()}t.getTimestamp=n;function i(f,p){for(var g=!1,y=Object.keys(f),m=0;m<y.length;m++)if(p===f[y[m]]){g=!0;break}return g}t.isValidEnum=i;function o(f,p){var g={};return f.forEach(function(y){var m=p(y);g[m]=g[m]||[],g[m].push(y)}),a(g)}t.groupBy=o;function a(f){return Object.keys(f).map(function(p){return f[p]})}t.objectValues=a;function u(f){return Object.keys(f).map(function(p){return[p,f[p]]})}t.objectEntries=u;function s(f,p){for(var g,y=0,m=f;y<m.length;y++){var R=m[y];if(p(R)){g=R;break}}return g}t.find=s;function l(f,p){var g={};return f.forEach(function(y){var m=p(y);g[m]=y}),g}t.keyBy=l;function c(f){for(var p=[],g=1;g<arguments.length;g++)p[g-1]=arguments[g];var y=0;return f.replace(/%s/g,function(){var m=p[y++],R=typeof m;return R==="function"?m():R==="string"?m:String(m)})}t.sprintf=c,function(f){f.ACTIVATE="ACTIVATE:experiment, user_id,attributes, variation, event",f.DECISION="DECISION:type, userId, attributes, decisionInfo",f.LOG_EVENT="LOG_EVENT:logEvent",f.OPTIMIZELY_CONFIG_UPDATE="OPTIMIZELY_CONFIG_UPDATE",f.TRACK="TRACK:event_key, user_id, attributes, event_tags, event"}(t.NOTIFICATION_TYPES||(t.NOTIFICATION_TYPES={}))})(I);var oi=T&&T.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var o=arguments[e],a=0,u=o.length;a<u;a++,i++)n[i]=o[a];return n};Object.defineProperty($,"__esModule",{value:!0});var ai=J,Te=I,A=Ze,Yt={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4};function Qe(t){return typeof t!="string"||(t=t.toUpperCase(),t==="WARN"&&(t="WARNING"),!Yt[t])?t:Yt[t]}var qt=function(){function t(){this.defaultLoggerFacade=new $t,this.loggers={}}return t.prototype.getLogger=function(e){return e?(this.loggers[e]||(this.loggers[e]=new $t({messagePrefix:e})),this.loggers[e]):this.defaultLoggerFacade},t}(),si=function(){function t(e){e===void 0&&(e={}),this.logLevel=A.LogLevel.NOTSET,e.logLevel!==void 0&&Te.isValidEnum(A.LogLevel,e.logLevel)&&this.setLogLevel(e.logLevel),this.logToConsole=e.logToConsole!==void 0?!!e.logToConsole:!0,this.prefix=e.prefix!==void 0?e.prefix:"[OPTIMIZELY]"}return t.prototype.log=function(e,r){if(!(!this.shouldLog(e)||!this.logToConsole)){var n=this.prefix+" - "+this.getLogLevelName(e)+" "+this.getTime()+" "+r;this.consoleLog(e,[n])}},t.prototype.setLogLevel=function(e){e=Qe(e),!Te.isValidEnum(A.LogLevel,e)||e===void 0?this.logLevel=A.LogLevel.ERROR:this.logLevel=e},t.prototype.getTime=function(){return new Date().toISOString()},t.prototype.shouldLog=function(e){return e>=this.logLevel},t.prototype.getLogLevelName=function(e){switch(e){case A.LogLevel.DEBUG:return"DEBUG";case A.LogLevel.INFO:return"INFO ";case A.LogLevel.WARNING:return"WARN ";case A.LogLevel.ERROR:return"ERROR";default:return"NOTSET"}},t.prototype.consoleLog=function(e,r){switch(e){case A.LogLevel.DEBUG:console.log.apply(console,r);break;case A.LogLevel.INFO:console.info.apply(console,r);break;case A.LogLevel.WARNING:console.warn.apply(console,r);break;case A.LogLevel.ERROR:console.error.apply(console,r);break;default:console.log.apply(console,r)}},t}();$.ConsoleLogHandler=si;var le=A.LogLevel.NOTSET,et=null,$t=function(){function t(e){e===void 0&&(e={}),this.messagePrefix="",e.messagePrefix&&(this.messagePrefix=e.messagePrefix)}return t.prototype.log=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];this.internalLog(Qe(e),{message:r,splat:n})},t.prototype.info=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];this.namedLog(A.LogLevel.INFO,e,r)},t.prototype.debug=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];this.namedLog(A.LogLevel.DEBUG,e,r)},t.prototype.warn=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];this.namedLog(A.LogLevel.WARNING,e,r)},t.prototype.error=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];this.namedLog(A.LogLevel.ERROR,e,r)},t.prototype.format=function(e){return(this.messagePrefix?this.messagePrefix+": ":"")+Te.sprintf.apply(void 0,oi([e.message],e.splat))},t.prototype.internalLog=function(e,r){!et||e<le||(et.log(e,this.format(r)),r.error&&r.error instanceof Error&&ai.getErrorHandler().handleError(r.error))},t.prototype.namedLog=function(e,r,n){var i;if(r instanceof Error){i=r,r=i.message,this.internalLog(e,{error:i,message:r,splat:n});return}if(n.length===0){this.internalLog(e,{message:r,splat:n});return}var o=n[n.length-1];o instanceof Error&&(i=o,n.splice(-1)),this.internalLog(e,{message:r,error:i,splat:n})},t}(),zt=new qt;function ui(t){return zt.getLogger(t)}$.getLogger=ui;function li(t){et=t}$.setLogHandler=li;function ci(t){t=Qe(t),!Te.isValidEnum(A.LogLevel,t)||t===void 0?le=A.LogLevel.ERROR:le=t}$.setLogLevel=ci;function fi(){return le}$.getLogLevel=fi;function di(){zt=new qt,le=A.LogLevel.NOTSET}$.resetLogger=di,function(t){function e(r){for(var n in r)t.hasOwnProperty(n)||(t[n]=r[n])}Object.defineProperty(t,"__esModule",{value:!0}),e(J),e(Ze),e($)}(O);var ce={},fe={};Object.defineProperty(fe,"__esModule",{value:!0}),fe.areEventContextsEqual=void 0;function Ei(t,e){var r=t.context,n=e.context;return r.accountId===n.accountId&&r.projectId===n.projectId&&r.clientName===n.clientName&&r.clientVersion===n.clientVersion&&r.revision===n.revision&&r.anonymizeIP===n.anonymizeIP&&r.botFiltering===n.botFiltering}fe.areEventContextsEqual=Ei;var tt={},re={};Object.defineProperty(re,"__esModule",{value:!0}),re.DefaultEventQueue=re.SingleEventQueue=void 0;var pi=O,gi=pi.getLogger("EventProcessor"),vi=function(){function t(e){var r=e.timeout,n=e.callback;this.timeout=Math.max(r,0),this.callback=n}return t.prototype.start=function(){this.timeoutId=setTimeout(this.callback,this.timeout)},t.prototype.refresh=function(){this.stop(),this.start()},t.prototype.stop=function(){this.timeoutId&&clearTimeout(this.timeoutId)},t}(),hi=function(){function t(e){var r=e.sink;this.sink=r}return t.prototype.start=function(){},t.prototype.stop=function(){return Promise.resolve()},t.prototype.enqueue=function(e){this.sink([e])},t}();re.SingleEventQueue=hi;var _i=function(){function t(e){var r=e.flushInterval,n=e.maxQueueSize,i=e.sink,o=e.batchComparator;this.buffer=[],this.maxQueueSize=Math.max(n,1),this.sink=i,this.batchComparator=o,this.timer=new vi({callback:this.flush.bind(this),timeout:r}),this.started=!1}return t.prototype.start=function(){this.started=!0},t.prototype.stop=function(){this.started=!1;var e=this.sink(this.buffer);return this.buffer=[],this.timer.stop(),e},t.prototype.enqueue=function(e){if(!this.started){gi.warn("Queue is stopped, not accepting event");return}var r=this.buffer[0];r&&!this.batchComparator(r,e)&&this.flush(),this.buffer.length===0&&this.timer.refresh(),this.buffer.push(e),this.buffer.length>=this.maxQueueSize&&this.flush()},t.prototype.flush=function(){this.sink(this.buffer),this.buffer=[],this.timer.stop()},t}();re.DefaultEventQueue=_i,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sendEventNotification=t.getQueue=t.validateAndGetBatchSize=t.validateAndGetFlushInterval=t.DEFAULT_BATCH_SIZE=t.DEFAULT_FLUSH_INTERVAL=void 0;var e=re,r=O,n=I;t.DEFAULT_FLUSH_INTERVAL=3e4,t.DEFAULT_BATCH_SIZE=10;var i=r.getLogger("EventProcessor");function o(l){return l<=0&&(i.warn("Invalid flushInterval "+l+", defaulting to "+t.DEFAULT_FLUSH_INTERVAL),l=t.DEFAULT_FLUSH_INTERVAL),l}t.validateAndGetFlushInterval=o;function a(l){return l=Math.floor(l),l<1&&(i.warn("Invalid batchSize "+l+", defaulting to "+t.DEFAULT_BATCH_SIZE),l=t.DEFAULT_BATCH_SIZE),l=Math.max(1,l),l}t.validateAndGetBatchSize=a;function u(l,c,f,p){var g;return l>1?g=new e.DefaultEventQueue({flushInterval:c,maxQueueSize:l,sink:f,batchComparator:p}):g=new e.SingleEventQueue({sink:f}),g}t.getQueue=u;function s(l,c){l&&l.sendNotifications(n.NOTIFICATION_TYPES.LOG_EVENT,c)}t.sendEventNotification=s}(tt);var Xt={};Object.defineProperty(Xt,"__esModule",{value:!0});var Wt={};Object.defineProperty(Wt,"__esModule",{value:!0});var ne={},Ne={};Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.LocalStorageStore=void 0;var Ii=I,yi=O,Jt=yi.getLogger("EventProcessor"),mi=function(){function t(e){var r=e.key,n=e.maxValues,i=n===void 0?1e3:n;this.LS_KEY=r,this.maxValues=i}return t.prototype.get=function(e){return this.getMap()[e]||null},t.prototype.set=function(e,r){var n=this.getMap();n[e]=r,this.replace(n)},t.prototype.remove=function(e){var r=this.getMap();delete r[e],this.replace(r)},t.prototype.values=function(){return Ii.objectValues(this.getMap())},t.prototype.clear=function(){this.replace({})},t.prototype.replace=function(e){try{window.localStorage&&localStorage.setItem(this.LS_KEY,JSON.stringify(e)),this.clean()}catch(r){Jt.error(r)}},t.prototype.clean=function(){var e=this.getMap(),r=Object.keys(e),n=r.length-this.maxValues;if(!(n<1)){var i=r.map(function(a){return{key:a,value:e[a]}});i.sort(function(a,u){return a.value.timestamp-u.value.timestamp});for(var o=0;o<n;o++)delete e[i[o].key];this.replace(e)}},t.prototype.getMap=function(){try{var e=window.localStorage&&localStorage.getItem(this.LS_KEY);if(e)return JSON.parse(e)||{}}catch(r){Jt.error(r)}return{}},t}();Ne.LocalStorageStore=mi;var Ri=T&&T.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(ne,"__esModule",{value:!0}),ne.LocalStoragePendingEventsDispatcher=ne.PendingEventsDispatcher=void 0;var Oi=O,Ti=Ne,Zt=I,Ni=Oi.getLogger("EventProcessor"),Qt=function(){function t(e){var r=e.eventDispatcher,n=e.store;this.dispatcher=r,this.store=n}return t.prototype.dispatchEvent=function(e,r){this.send({uuid:Zt.generateUUID(),timestamp:Zt.getTimestamp(),request:e},r)},t.prototype.sendPendingEvents=function(){var e=this,r=this.store.values();Ni.debug("Sending %s pending events from previous page",r.length),r.forEach(function(n){try{e.send(n,function(){})}catch{}})},t.prototype.send=function(e,r){var n=this;this.store.set(e.uuid,e),this.dispatcher.dispatchEvent(e.request,function(i){n.store.remove(e.uuid),r(i)})},t}();ne.PendingEventsDispatcher=Qt;var Ai=function(t){Ri(e,t);function e(r){var n=r.eventDispatcher;return t.call(this,{eventDispatcher:n,store:new Ti.LocalStorageStore({maxValues:100,key:"fs_optly_pending_events"})})||this}return e}(Qt);ne.LocalStoragePendingEventsDispatcher=Ai;var K={},rt=T&&T.__assign||function(){return rt=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},rt.apply(this,arguments)};Object.defineProperty(K,"__esModule",{value:!0}),K.formatEvents=K.buildConversionEventV1=K.buildImpressionEventV1=K.makeBatchedEventV1=void 0;var Si="campaign_activated",Li="custom",er="$opt_bot_filtering";function tr(t){var e=[],r=t[0];return t.forEach(function(n){if(n.type==="conversion"||n.type==="impression"){var i=nt(n);n.type==="impression"?i.snapshots.push(nr(n)):n.type==="conversion"&&i.snapshots.push(rr(n)),e.push(i)}}),{client_name:r.context.clientName,client_version:r.context.clientVersion,account_id:r.context.accountId,project_id:r.context.projectId,revision:r.context.revision,anonymize_ip:r.context.anonymizeIP,enrich_decisions:!0,visitors:e}}K.makeBatchedEventV1=tr;function rr(t){var e=rt({},t.tags);delete e.revenue,delete e.value;var r={entity_id:t.event.id,key:t.event.key,timestamp:t.timestamp,uuid:t.uuid};return t.tags&&(r.tags=t.tags),t.value!=null&&(r.value=t.value),t.revenue!=null&&(r.revenue=t.revenue),{events:[r]}}function nr(t){var e,r,n=t.layer,i=t.experiment,o=t.variation,a=t.ruleKey,u=t.flagKey,s=t.ruleType,l=t.enabled,c=n?n.id:null,f=(e=i==null?void 0:i.id)!==null&&e!==void 0?e:"",p=(r=o==null?void 0:o.id)!==null&&r!==void 0?r:"",g=o?o.key:"";return{decisions:[{campaign_id:c,experiment_id:f,variation_id:p,metadata:{flag_key:u,rule_key:a,rule_type:s,variation_key:g,enabled:l}}],events:[{entity_id:c,timestamp:t.timestamp,key:Si,uuid:t.uuid}]}}function nt(t){var e={snapshots:[],visitor_id:t.user.id,attributes:[]};return t.user.attributes.forEach(function(r){e.attributes.push({entity_id:r.entityId,key:r.key,type:"custom",value:r.value})}),typeof t.context.botFiltering=="boolean"&&e.attributes.push({entity_id:er,key:er,type:Li,value:t.context.botFiltering}),e}function Di(t){var e=nt(t);return e.snapshots.push(nr(t)),{client_name:t.context.clientName,client_version:t.context.clientVersion,account_id:t.context.accountId,project_id:t.context.projectId,revision:t.context.revision,anonymize_ip:t.context.anonymizeIP,enrich_decisions:!0,visitors:[e]}}K.buildImpressionEventV1=Di;function Ui(t){var e=nt(t);return e.snapshots.push(rr(t)),{client_name:t.context.clientName,client_version:t.context.clientVersion,account_id:t.context.accountId,project_id:t.context.projectId,revision:t.context.revision,anonymize_ip:t.context.anonymizeIP,enrich_decisions:!0,visitors:[e]}}K.buildConversionEventV1=Ui;function bi(t){return{url:"https://logx.optimizely.com/v1/events",httpVerb:"POST",params:tr(t)}}K.formatEvents=bi;var Ae={},it={};Object.defineProperty(it,"__esModule",{value:!0});var Ci=function(){function t(){this.reqsInFlightCount=0,this.reqsCompleteResolvers=[]}return t.prototype.trackRequest=function(e){var r=this;this.reqsInFlightCount++;var n=function(){r.reqsInFlightCount--,r.reqsInFlightCount===0&&(r.reqsCompleteResolvers.forEach(function(i){return i()}),r.reqsCompleteResolvers=[])};e.then(n,n)},t.prototype.onRequestsComplete=function(){var e=this;return new Promise(function(r){e.reqsInFlightCount===0?r():e.reqsCompleteResolvers.push(r)})},t}();it.default=Ci;var Vi=T&&T.__awaiter||function(t,e,r,n){function i(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function u(c){try{l(n.next(c))}catch(f){a(f)}}function s(c){try{l(n.throw(c))}catch(f){a(f)}}function l(c){c.done?o(c.value):i(c.value).then(u,s)}l((n=n.apply(t,e||[])).next())})},Pi=T&&T.__generator||function(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(l){return function(c){return s([l,c])}}function s(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(l[0]===6&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(c){l=[6,c],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},Mi=T&&T.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.LogTierV1EventProcessor=void 0;var Fi=O,ie=tt,xi=Mi(it),ki=fe,wi=K,ir=Fi.getLogger("LogTierV1EventProcessor"),Bi=function(){function t(e){var r=e.dispatcher,n=e.flushInterval,i=n===void 0?ie.DEFAULT_FLUSH_INTERVAL:n,o=e.batchSize,a=o===void 0?ie.DEFAULT_BATCH_SIZE:o,u=e.notificationCenter;this.dispatcher=r,this.notificationCenter=u,this.requestTracker=new xi.default,i=ie.validateAndGetFlushInterval(i),a=ie.validateAndGetBatchSize(a),this.queue=ie.getQueue(a,i,this.drainQueue.bind(this),ki.areEventContextsEqual)}return t.prototype.drainQueue=function(e){var r=this,n=new Promise(function(i){if(ir.debug("draining queue with %s events",e.length),e.length===0){i();return}var o=wi.formatEvents(e);r.dispatcher.dispatchEvent(o,function(){i()}),ie.sendEventNotification(r.notificationCenter,o)});return this.requestTracker.trackRequest(n),n},t.prototype.process=function(e){this.queue.enqueue(e)},t.prototype.stop=function(){try{return this.queue.stop(),this.requestTracker.onRequestsComplete()}catch(e){ir.error('Error stopping EventProcessor: "%s"',e.message,e)}return Promise.resolve()},t.prototype.start=function(){return Vi(this,void 0,void 0,function(){return Pi(this,function(e){return this.queue.start(),[2]})})},t}();Ae.LogTierV1EventProcessor=Bi,function(t){var e=T&&T.__createBinding||(Object.create?function(n,i,o,a){a===void 0&&(a=o),Object.defineProperty(n,a,{enumerable:!0,get:function(){return i[o]}})}:function(n,i,o,a){a===void 0&&(a=o),n[a]=i[o]}),r=T&&T.__exportStar||function(n,i){for(var o in n)o!=="default"&&!Object.prototype.hasOwnProperty.call(i,o)&&e(i,n,o)};Object.defineProperty(t,"__esModule",{value:!0}),r(fe,t),r(tt,t),r(Xt,t),r(Wt,t),r(ne,t),r(K,t),r(Ae,t)}(ce);var or={exports:{}};(function(t){(function(){function e(i,o){for(var a=i.length,u=o^a,s=0,l;a>=4;)l=i.charCodeAt(s)&255|(i.charCodeAt(++s)&255)<<8|(i.charCodeAt(++s)&255)<<16|(i.charCodeAt(++s)&255)<<24,l=(l&65535)*1540483477+(((l>>>16)*1540483477&65535)<<16),l^=l>>>24,l=(l&65535)*1540483477+(((l>>>16)*1540483477&65535)<<16),u=(u&65535)*1540483477+(((u>>>16)*1540483477&65535)<<16)^l,a-=4,++s;switch(a){case 3:u^=(i.charCodeAt(s+2)&255)<<16;case 2:u^=(i.charCodeAt(s+1)&255)<<8;case 1:u^=i.charCodeAt(s)&255,u=(u&65535)*1540483477+(((u>>>16)*1540483477&65535)<<16)}return u^=u>>>13,u=(u&65535)*1540483477+(((u>>>16)*1540483477&65535)<<16),u^=u>>>15,u>>>0}function r(i,o){var a,u,s,l,c,f,p,g;for(a=i.length&3,u=i.length-a,s=o,c=3432918353,f=461845907,g=0;g<u;)p=i.charCodeAt(g)&255|(i.charCodeAt(++g)&255)<<8|(i.charCodeAt(++g)&255)<<16|(i.charCodeAt(++g)&255)<<24,++g,p=(p&65535)*c+(((p>>>16)*c&65535)<<16)&4294967295,p=p<<15|p>>>17,p=(p&65535)*f+(((p>>>16)*f&65535)<<16)&4294967295,s^=p,s=s<<13|s>>>19,l=(s&65535)*5+(((s>>>16)*5&65535)<<16)&4294967295,s=(l&65535)+27492+(((l>>>16)+58964&65535)<<16);switch(p=0,a){case 3:p^=(i.charCodeAt(g+2)&255)<<16;case 2:p^=(i.charCodeAt(g+1)&255)<<8;case 1:p^=i.charCodeAt(g)&255,p=(p&65535)*c+(((p>>>16)*c&65535)<<16)&4294967295,p=p<<15|p>>>17,p=(p&65535)*f+(((p>>>16)*f&65535)<<16)&4294967295,s^=p}return s^=i.length,s^=s>>>16,s=(s&65535)*2246822507+(((s>>>16)*2246822507&65535)<<16)&4294967295,s^=s>>>13,s=(s&65535)*3266489909+(((s>>>16)*3266489909&65535)<<16)&4294967295,s^=s>>>16,s>>>0}var n=r;n.v2=e,n.v3=r,t.exports=n})()})(or);var Ki=or.exports,ar={},ot={},at={},j={};Object.defineProperty(j,"__esModule",{value:!0}),j.DEFAULT_UPDATE_INTERVAL=5*60*1e3,j.MIN_UPDATE_INTERVAL=1e3,j.DEFAULT_URL_TEMPLATE="https://cdn.optimizely.com/datafiles/%s.json",j.DEFAULT_AUTHENTICATED_URL_TEMPLATE="https://config.optimizely.com/datafiles/auth/%s.json",j.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT=[0,8,16,32,64,128,256,512],j.REQUEST_TIMEOUT_MS=60*1e3,Object.defineProperty(at,"__esModule",{value:!0});var ji=j,Gi=O,Hi=Gi.getLogger("DatafileManager"),Yi="GET",qi=4;function $i(t){var e=t.getAllResponseHeaders();if(e===null)return{};var r=e.split(`\r
`),n={};return r.forEach(function(i){var o=i.indexOf(": ");if(o>-1){var a=i.slice(0,o),u=i.slice(o+2);u.length>0&&(n[a]=u)}}),n}function zi(t,e){Object.keys(t).forEach(function(r){var n=t[r];e.setRequestHeader(r,n)})}function Xi(t,e){var r=new XMLHttpRequest,n=new Promise(function(i,o){r.open(Yi,t,!0),zi(e,r),r.onreadystatechange=function(){if(r.readyState===qi){var a=r.status;if(a===0){o(new Error("Request error"));return}var u=$i(r),s={statusCode:r.status,body:r.responseText,headers:u};i(s)}},r.timeout=ji.REQUEST_TIMEOUT_MS,r.ontimeout=function(){Hi.error("Request timed out")},r.send()});return{responsePromise:n,abort:function(){r.abort()}}}at.makeGetRequest=Xi;var st={},ut={};Object.defineProperty(ut,"__esModule",{value:!0});var Wi=function(){function t(){this.listeners={},this.listenerId=1}return t.prototype.on=function(e,r){var n=this;this.listeners[e]||(this.listeners[e]={});var i=String(this.listenerId);return this.listenerId++,this.listeners[e][i]=r,function(){n.listeners[e]&&delete n.listeners[e][i]}},t.prototype.emit=function(e,r){var n=this.listeners[e];n&&Object.keys(n).forEach(function(i){var o=n[i];o(r)})},t.prototype.removeAllListeners=function(){this.listeners={}},t}();ut.default=Wi;var lt={};Object.defineProperty(lt,"__esModule",{value:!0});var ct=j;function Ji(){return Math.round(Math.random()*1e3)}var Zi=function(){function t(){this.errorCount=0}return t.prototype.getDelay=function(){if(this.errorCount===0)return 0;var e=ct.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT[Math.min(ct.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT.length-1,this.errorCount)];return e*1e3+Ji()},t.prototype.countError=function(){this.errorCount<ct.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT.length-1&&this.errorCount++},t.prototype.reset=function(){this.errorCount=0},t}();lt.default=Zi;var Se=T&&T.__assign||function(){return Se=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Se.apply(this,arguments)},sr=T&&T.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(st,"__esModule",{value:!0});var Qi=O,eo=I,to=sr(ut),de=j,ro=sr(lt),k=Qi.getLogger("DatafileManager"),no="update";function io(t){return t>=de.MIN_UPDATE_INTERVAL}function ur(t){return t>=200&&t<400}var oo={get:function(){return Promise.resolve("")},set:function(){return Promise.resolve()},contains:function(){return Promise.resolve(!1)},remove:function(){return Promise.resolve()}},ao=function(){function t(e){var r=this,n=Se(Se({},this.getConfigDefaults()),e),i=n.datafile,o=n.autoUpdate,a=o===void 0?!1:o,u=n.sdkKey,s=n.updateInterval,l=s===void 0?de.DEFAULT_UPDATE_INTERVAL:s,c=n.urlTemplate,f=c===void 0?de.DEFAULT_URL_TEMPLATE:c,p=n.cache,g=p===void 0?oo:p;this.cache=g,this.cacheKey="opt-datafile-"+u,this.isReadyPromiseSettled=!1,this.readyPromiseResolver=function(){},this.readyPromiseRejecter=function(){},this.readyPromise=new Promise(function(y,m){r.readyPromiseResolver=y,r.readyPromiseRejecter=m}),i?(this.currentDatafile=i,u||this.resolveReadyPromise()):this.currentDatafile="",this.isStarted=!1,this.datafileUrl=eo.sprintf(f,u),this.emitter=new to.default,this.autoUpdate=a,io(l)?this.updateInterval=l:(k.warn("Invalid updateInterval %s, defaulting to %s",l,de.DEFAULT_UPDATE_INTERVAL),this.updateInterval=de.DEFAULT_UPDATE_INTERVAL),this.currentTimeout=null,this.currentRequest=null,this.backoffController=new ro.default,this.syncOnCurrentRequestComplete=!1}return t.prototype.get=function(){return this.currentDatafile},t.prototype.start=function(){this.isStarted||(k.debug("Datafile manager started"),this.isStarted=!0,this.backoffController.reset(),this.setDatafileFromCacheIfAvailable(),this.syncDatafile())},t.prototype.stop=function(){return k.debug("Datafile manager stopped"),this.isStarted=!1,this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=null),this.emitter.removeAllListeners(),this.currentRequest&&(this.currentRequest.abort(),this.currentRequest=null),Promise.resolve()},t.prototype.onReady=function(){return this.readyPromise},t.prototype.on=function(e,r){return this.emitter.on(e,r)},t.prototype.onRequestRejected=function(e){!this.isStarted||(this.backoffController.countError(),e instanceof Error?k.error("Error fetching datafile: %s",e.message,e):typeof e=="string"?k.error("Error fetching datafile: %s",e):k.error("Error fetching datafile"))},t.prototype.onRequestResolved=function(e){if(!!this.isStarted){typeof e.statusCode!="undefined"&&ur(e.statusCode)?this.backoffController.reset():this.backoffController.countError(),this.trySavingLastModified(e.headers);var r=this.getNextDatafileFromResponse(e);if(r!=="")if(k.info("Updating datafile from response"),this.currentDatafile=r,this.cache.set(this.cacheKey,r),!this.isReadyPromiseSettled)this.resolveReadyPromise();else{var n={datafile:r};this.emitter.emit(no,n)}}},t.prototype.onRequestComplete=function(){!this.isStarted||(this.currentRequest=null,!this.isReadyPromiseSettled&&!this.autoUpdate&&this.rejectReadyPromise(new Error("Failed to become ready")),this.autoUpdate&&this.syncOnCurrentRequestComplete&&this.syncDatafile(),this.syncOnCurrentRequestComplete=!1)},t.prototype.syncDatafile=function(){var e=this,r={};this.lastResponseLastModified&&(r["if-modified-since"]=this.lastResponseLastModified),k.debug("Making datafile request to url %s with headers: %s",this.datafileUrl,function(){return JSON.stringify(r)}),this.currentRequest=this.makeGetRequest(this.datafileUrl,r);var n=function(){e.onRequestComplete()},i=function(a){e.onRequestResolved(a)},o=function(a){e.onRequestRejected(a)};this.currentRequest.responsePromise.then(i,o).then(n,n),this.autoUpdate&&this.scheduleNextUpdate()},t.prototype.resolveReadyPromise=function(){this.readyPromiseResolver(),this.isReadyPromiseSettled=!0},t.prototype.rejectReadyPromise=function(e){this.readyPromiseRejecter(e),this.isReadyPromiseSettled=!0},t.prototype.scheduleNextUpdate=function(){var e=this,r=this.backoffController.getDelay(),n=Math.max(r,this.updateInterval);k.debug("Scheduling sync in %s ms",n),this.currentTimeout=setTimeout(function(){e.currentRequest?e.syncOnCurrentRequestComplete=!0:e.syncDatafile()},n)},t.prototype.getNextDatafileFromResponse=function(e){return k.debug("Response status code: %s",e.statusCode),typeof e.statusCode=="undefined"||e.statusCode===304?"":ur(e.statusCode)?e.body:""},t.prototype.trySavingLastModified=function(e){var r=e["last-modified"]||e["Last-Modified"];typeof r!="undefined"&&(this.lastResponseLastModified=r,k.debug("Saved last modified header value from response: %s",this.lastResponseLastModified))},t.prototype.setDatafileFromCacheIfAvailable=function(){var e=this;this.cache.get(this.cacheKey).then(function(r){e.isStarted&&!e.isReadyPromiseSettled&&r!==""&&(k.debug("Using datafile from cache"),e.currentDatafile=r,e.resolveReadyPromise())})},t}();st.default=ao;var so=T&&T.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),uo=T&&T.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ot,"__esModule",{value:!0});var lo=at,co=uo(st),fo=function(t){so(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.makeGetRequest=function(r,n){return lo.makeGetRequest(r,n)},e.prototype.getConfigDefaults=function(){return{autoUpdate:!1}},e}(co.default);ot.default=fo,Object.defineProperty(ar,"__esModule",{value:!0});var Eo=ot,po=ar.HttpPollingDatafileManager=Eo.default;/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */var Z=function(){return(Z=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function ft(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],a=0,u=o.length;a<u;a++,i++)n[i]=o[a];return n}var d={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4},_={CONDITION_EVALUATOR_ERROR:"%s: Error evaluating audience condition of type %s: %s",DATAFILE_AND_SDK_KEY_MISSING:"%s: You must provide at least one of sdkKey or datafile. Cannot start Optimizely",EXPERIMENT_KEY_NOT_IN_DATAFILE:"%s: Experiment key %s is not in datafile.",FEATURE_NOT_IN_DATAFILE:"%s: Feature key %s is not in datafile.",IMPROPERLY_FORMATTED_EXPERIMENT:"%s: Experiment key %s is improperly formatted.",INVALID_ATTRIBUTES:"%s: Provided attributes are in an invalid format.",INVALID_BUCKETING_ID:"%s: Unable to generate hash for bucketing ID %s: %s",INVALID_DATAFILE:"%s: Datafile is invalid - property %s: %s",INVALID_DATAFILE_MALFORMED:"%s: Datafile is invalid because it is malformed.",INVALID_CONFIG:"%s: Provided Optimizely config is in an invalid format.",INVALID_JSON:"%s: JSON object is not valid.",INVALID_ERROR_HANDLER:'%s: Provided "errorHandler" is in an invalid format.',INVALID_EVENT_DISPATCHER:'%s: Provided "eventDispatcher" is in an invalid format.',INVALID_EVENT_TAGS:"%s: Provided event tags are in an invalid format.",INVALID_EXPERIMENT_KEY:"%s: Experiment key %s is not in datafile. It is either invalid, paused, or archived.",INVALID_EXPERIMENT_ID:"%s: Experiment ID %s is not in datafile.",INVALID_GROUP_ID:"%s: Group ID %s is not in datafile.",INVALID_LOGGER:'%s: Provided "logger" is in an invalid format.',INVALID_ROLLOUT_ID:"%s: Invalid rollout ID %s attached to feature %s",INVALID_USER_ID:"%s: Provided user ID is in an invalid format.",INVALID_USER_PROFILE_SERVICE:"%s: Provided user profile service instance is in an invalid format: %s.",NO_DATAFILE_SPECIFIED:"%s: No datafile specified. Cannot start optimizely.",NO_JSON_PROVIDED:"%s: No JSON object to validate against schema.",NO_VARIATION_FOR_EXPERIMENT_KEY:"%s: No variation key %s defined in datafile for experiment %s.",UNDEFINED_ATTRIBUTE:"%s: Provided attribute: %s has an undefined value.",UNRECOGNIZED_ATTRIBUTE:"%s: Unrecognized attribute %s provided. Pruning before sending event to Optimizely.",UNABLE_TO_CAST_VALUE:"%s: Unable to cast value %s to type %s, returning null.",USER_NOT_IN_FORCED_VARIATION:"%s: User %s is not in the forced variation map. Cannot remove their forced variation.",USER_PROFILE_LOOKUP_ERROR:'%s: Error while looking up user profile for user ID "%s": %s.',USER_PROFILE_SAVE_ERROR:'%s: Error while saving user profile for user ID "%s": %s.',VARIABLE_KEY_NOT_IN_DATAFILE:'%s: Variable with key "%s" associated with feature with key "%s" is not in datafile.',VARIATION_ID_NOT_IN_DATAFILE:"%s: No variation ID %s defined in datafile for experiment %s.",VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT:"%s: Variation ID %s is not in the datafile.",INVALID_INPUT_FORMAT:"%s: Provided %s is in an invalid format.",INVALID_DATAFILE_VERSION:"%s: This version of the JavaScript SDK does not support the given datafile version: %s",INVALID_VARIATION_KEY:"%s: Provided variation key is in an invalid format."},E={ACTIVATE_USER:"%s: Activating user %s in experiment %s.",DISPATCH_CONVERSION_EVENT:"%s: Dispatching conversion event to URL %s with params %s.",DISPATCH_IMPRESSION_EVENT:"%s: Dispatching impression event to URL %s with params %s.",DEPRECATED_EVENT_VALUE:"%s: Event value is deprecated in %s call.",EVENT_KEY_NOT_FOUND:"%s: Event key %s is not in datafile.",EXPERIMENT_NOT_RUNNING:"%s: Experiment %s is not running.",FEATURE_ENABLED_FOR_USER:"%s: Feature %s is enabled for user %s.",FEATURE_NOT_ENABLED_FOR_USER:"%s: Feature %s is not enabled for user %s.",FEATURE_HAS_NO_EXPERIMENTS:"%s: Feature %s is not attached to any experiments.",FAILED_TO_PARSE_VALUE:'%s: Failed to parse event value "%s" from event tags.',FAILED_TO_PARSE_REVENUE:'%s: Failed to parse revenue value "%s" from event tags.',FORCED_BUCKETING_FAILED:"%s: Variation key %s is not in datafile. Not activating user %s.",INVALID_OBJECT:"%s: Optimizely object is not valid. Failing %s.",INVALID_CLIENT_ENGINE:"%s: Invalid client engine passed: %s. Defaulting to node-sdk.",INVALID_DEFAULT_DECIDE_OPTIONS:"%s: Provided default decide options is not an array.",INVALID_DECIDE_OPTIONS:"%s: Provided decide options is not an array. Using default decide options.",INVALID_VARIATION_ID:"%s: Bucketed into an invalid variation ID. Returning null.",NOTIFICATION_LISTENER_EXCEPTION:"%s: Notification listener for (%s) threw exception: %s",NO_ROLLOUT_EXISTS:"%s: There is no rollout of feature %s.",NOT_ACTIVATING_USER:"%s: Not activating user %s for experiment %s.",NOT_TRACKING_USER:"%s: Not tracking user %s.",PARSED_REVENUE_VALUE:'%s: Parsed revenue value "%s" from event tags.',PARSED_NUMERIC_VALUE:'%s: Parsed event value "%s" from event tags.',RETURNING_STORED_VARIATION:'%s: Returning previously activated variation "%s" of experiment "%s" for user "%s" from user profile.',ROLLOUT_HAS_NO_EXPERIMENTS:"%s: Rollout of feature %s has no experiments",SAVED_VARIATION:'%s: Saved variation "%s" of experiment "%s" for user "%s".',SAVED_VARIATION_NOT_FOUND:"%s: User %s was previously bucketed into variation with ID %s for experiment %s, but no matching variation was found.",SHOULD_NOT_DISPATCH_ACTIVATE:'%s: Experiment %s is not in "Running" state. Not activating user.',SKIPPING_JSON_VALIDATION:"%s: Skipping JSON schema validation.",TRACK_EVENT:"%s: Tracking event %s for user %s.",UNRECOGNIZED_DECIDE_OPTION:"%s: Unrecognized decide option %s provided.",USER_ASSIGNED_TO_EXPERIMENT_BUCKET:"%s: Assigned bucket %s to user with bucketing ID %s.",USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is in experiment %s of group %s.",USER_BUCKETED_INTO_TARGETING_RULE:"%s: User %s bucketed into targeting rule %s.",USER_IN_FEATURE_EXPERIMENT:"%s: User %s is in variation %s of experiment %s on the feature %s.",USER_IN_ROLLOUT:"%s: User %s is in rollout of feature %s.",USER_NOT_BUCKETED_INTO_EVERYONE_TARGETING_RULE:"%s: User %s not bucketed into everyone targeting rule due to traffic allocation.",USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is not in experiment %s of group %s.",USER_NOT_BUCKETED_INTO_ANY_EXPERIMENT_IN_GROUP:"%s: User %s is not in any experiment of group %s.",USER_NOT_BUCKETED_INTO_TARGETING_RULE:"%s User %s not bucketed into targeting rule %s due to traffic allocation. Trying everyone rule.",USER_NOT_IN_FEATURE_EXPERIMENT:"%s: User %s is not in any experiment on the feature %s.",USER_NOT_IN_ROLLOUT:"%s: User %s is not in rollout of feature %s.",USER_FORCED_IN_VARIATION:"%s: User %s is forced in variation %s.",USER_MAPPED_TO_FORCED_VARIATION:"%s: Set variation %s for experiment %s and user %s in the forced variation map.",USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s does not meet conditions for targeting rule %s.",USER_MEETS_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s meets conditions for targeting rule %s.",USER_HAS_VARIATION:"%s: User %s is in variation %s of experiment %s.",USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED:"Variation (%s) is mapped to flag (%s), rule (%s) and user (%s) in the forced decision map.",USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED:"Variation (%s) is mapped to flag (%s) and user (%s) in the forced decision map.",USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED_BUT_INVALID:"Invalid variation is mapped to flag (%s), rule (%s) and user (%s) in the forced decision map.",USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED_BUT_INVALID:"Invalid variation is mapped to flag (%s) and user (%s) in the forced decision map.",USER_HAS_FORCED_VARIATION:"%s: Variation %s is mapped to experiment %s and user %s in the forced variation map.",USER_HAS_NO_VARIATION:"%s: User %s is in no variation of experiment %s.",USER_HAS_NO_FORCED_VARIATION:"%s: User %s is not in the forced variation map.",USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT:"%s: No experiment %s mapped to user %s in the forced variation map.",USER_NOT_IN_ANY_EXPERIMENT:"%s: User %s is not in any experiment of group %s.",USER_NOT_IN_EXPERIMENT:"%s: User %s does not meet conditions to be in experiment %s.",USER_RECEIVED_DEFAULT_VARIABLE_VALUE:'%s: User "%s" is not in any variation or rollout rule. Returning default value for variable "%s" of feature flag "%s".',FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Feature "%s" is not enabled for user %s. Returning the default variable value "%s".',VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Variable "%s" is not used in variation "%s". Returning default value.',USER_RECEIVED_VARIABLE_VALUE:'%s: Got variable value "%s" for variable "%s" of feature flag "%s"',VALID_DATAFILE:"%s: Datafile is valid.",VALID_USER_PROFILE_SERVICE:"%s: Valid user profile service provided.",VARIATION_REMOVED_FOR_USER:"%s: Variation mapped to experiment %s has been removed for user %s.",VARIABLE_REQUESTED_WITH_WRONG_TYPE:'%s: Requested variable type "%s", but variable is of type "%s". Use correct API to retrieve value. Returning None.',VALID_BUCKETING_ID:'%s: BucketingId is valid: "%s"',BUCKETING_ID_NOT_STRING:"%s: BucketingID attribute is not a string. Defaulted to userId",EVALUATING_AUDIENCE:'%s: Starting to evaluate audience "%s" with conditions: %s.',EVALUATING_AUDIENCES_COMBINED:'%s: Evaluating audiences for %s "%s": %s.',AUDIENCE_EVALUATION_RESULT:'%s: Audience "%s" evaluated to %s.',AUDIENCE_EVALUATION_RESULT_COMBINED:"%s: Audiences for %s %s collectively evaluated to %s.",MISSING_ATTRIBUTE_VALUE:'%s: Audience condition %s evaluated to UNKNOWN because no value was passed for user attribute "%s".',UNEXPECTED_CONDITION_VALUE:"%s: Audience condition %s evaluated to UNKNOWN because the condition value is not supported.",UNEXPECTED_TYPE:'%s: Audience condition %s evaluated to UNKNOWN because a value of type "%s" was passed for user attribute "%s".',UNEXPECTED_TYPE_NULL:'%s: Audience condition %s evaluated to UNKNOWN because a null value was passed for user attribute "%s".',UNKNOWN_CONDITION_TYPE:"%s: Audience condition %s has an unknown condition type. You may need to upgrade to a newer release of the Optimizely SDK.",UNKNOWN_MATCH_TYPE:"%s: Audience condition %s uses an unknown match type. You may need to upgrade to a newer release of the Optimizely SDK.",UPDATED_OPTIMIZELY_CONFIG:"%s: Updated Optimizely config to revision %s (project id %s)",OUT_OF_BOUNDS:'%s: Audience condition %s evaluated to UNKNOWN because the number value for user attribute "%s" is not in the range [-2^53, +2^53].',UNABLE_TO_ATTACH_UNLOAD:'%s: unable to bind optimizely.close() to page unload event: "%s"'},G={BOT_FILTERING:"$opt_bot_filtering",BUCKETING_ID:"$opt_bucketing_id",STICKY_BUCKETING_KEY:"$opt_experiment_bucket_map",USER_AGENT:"$opt_user_agent",FORCED_DECISION_NULL_RULE_KEY:"$opt_null_rule_key"},w=I.NOTIFICATION_TYPES,Q={AB_TEST:"ab-test",FEATURE:"feature",FEATURE_TEST:"feature-test",FEATURE_VARIABLE:"feature-variable",ALL_FEATURE_VARIABLES:"all-feature-variables",FLAG:"flag"},S={FEATURE_TEST:"feature-test",ROLLOUT:"rollout",EXPERIMENT:"experiment"},dt={RULE:"rule",EXPERIMENT:"experiment"},M={BOOLEAN:"boolean",DOUBLE:"double",INTEGER:"integer",STRING:"string",JSON:"json"},Le={V2:"2",V3:"3",V4:"4"},Et={SDK_NOT_READY:"Optimizely SDK not configured properly yet.",FLAG_KEY_INVALID:'No flag was found for key "%s".',VARIABLE_VALUE_INVALID:'Variable value for key "%s" is invalid or wrong type.'},go=Object.freeze({__proto__:null,LOG_LEVEL:d,ERROR_MESSAGES:_,LOG_MESSAGES:E,CONTROL_ATTRIBUTES:G,JAVASCRIPT_CLIENT_ENGINE:"javascript-sdk",NODE_CLIENT_ENGINE:"node-sdk",REACT_CLIENT_ENGINE:"react-sdk",REACT_NATIVE_CLIENT_ENGINE:"react-native-sdk",REACT_NATIVE_JS_CLIENT_ENGINE:"react-native-js-sdk",NODE_CLIENT_VERSION:"4.9.1",NOTIFICATION_TYPES:w,DECISION_NOTIFICATION_TYPES:Q,DECISION_SOURCES:S,AUDIENCE_EVALUATION_TYPES:dt,FEATURE_VARIABLE_TYPES:M,DATAFILE_VERSIONS:Le,DECISION_MESSAGES:Et}),ee="CONFIG_VALIDATOR",vo=[Le.V2,Le.V3,Le.V4],ho=function(t){if(typeof t=="object"&&t!==null){var e=t,r=e.errorHandler,n=e.eventDispatcher,i=e.logger;if(r&&typeof r.handleError!="function")throw new Error(I.sprintf(_.INVALID_ERROR_HANDLER,ee));if(n&&typeof n.dispatchEvent!="function")throw new Error(I.sprintf(_.INVALID_EVENT_DISPATCHER,ee));if(i&&typeof i.log!="function")throw new Error(I.sprintf(_.INVALID_LOGGER,ee));return!0}throw new Error(I.sprintf(_.INVALID_CONFIG,ee))},_o=function(t){if(!t)throw new Error(I.sprintf(_.NO_DATAFILE_SPECIFIED,ee));if(typeof t=="string")try{t=JSON.parse(t)}catch{throw new Error(I.sprintf(_.INVALID_DATAFILE_MALFORMED,ee))}if(typeof t=="object"&&!Array.isArray(t)&&t!==null&&vo.indexOf(t.version)===-1)throw new Error(I.sprintf(_.INVALID_DATAFILE_VERSION,ee,t.version));return t},Io={handleError:function(){}},yo=function(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")},lr={dispatchEvent:function(t,e){var r,n=t.params,i=t.url;t.httpVerb==="POST"?((r=new XMLHttpRequest).open("POST",i,!0),r.setRequestHeader("Content-Type","application/json"),r.onreadystatechange=function(){if(r.readyState===4&&e&&typeof e=="function")try{e({statusCode:r.status})}catch{}},r.send(JSON.stringify(n))):(i+="?wxhr=true",n&&(i+="&"+yo(n)),(r=new XMLHttpRequest).open("GET",i,!0),r.onreadystatechange=function(){if(r.readyState===4&&e&&typeof e=="function")try{e({statusCode:r.status})}catch{}},r.send())}},cr=function(){function t(){}return t.prototype.log=function(){},t}();function fr(t){return new O.ConsoleLogHandler(t)}var dr,H,mo=Object.freeze({__proto__:null,NoOpLogger:cr,createLogger:fr,createNoOpLogger:function(){return new cr}});function Er(t,e,r){return{variationKey:null,enabled:!1,variables:{},ruleKey:null,flagKey:t,userContext:e,reasons:r}}(function(t){t.BOOLEAN="boolean",t.DOUBLE="double",t.INTEGER="integer",t.STRING="string",t.JSON="json"})(dr||(dr={})),function(t){t.DISABLE_DECISION_EVENT="DISABLE_DECISION_EVENT",t.ENABLED_FLAGS_ONLY="ENABLED_FLAGS_ONLY",t.IGNORE_USER_PROFILE_SERVICE="IGNORE_USER_PROFILE_SERVICE",t.INCLUDE_REASONS="INCLUDE_REASONS",t.EXCLUDE_VARIABLES="EXCLUDE_VARIABLES"}(H||(H={}));var Ro=function(){function t(e){var r,n=e.optimizely,i=e.userId,o=e.attributes;this.optimizely=n,this.userId=i,this.attributes=(r=Z({},o))!==null&&r!==void 0?r:{},this.forcedDecisionsMap={}}return t.prototype.setAttribute=function(e,r){this.attributes[e]=r},t.prototype.getUserId=function(){return this.userId},t.prototype.getAttributes=function(){return Z({},this.attributes)},t.prototype.getOptimizely=function(){return this.optimizely},t.prototype.decide=function(e,r){return r===void 0&&(r=[]),this.optimizely.decide(this.cloneUserContext(),e,r)},t.prototype.decideForKeys=function(e,r){return r===void 0&&(r=[]),this.optimizely.decideForKeys(this.cloneUserContext(),e,r)},t.prototype.decideAll=function(e){return e===void 0&&(e=[]),this.optimizely.decideAll(this.cloneUserContext(),e)},t.prototype.trackEvent=function(e,r){this.optimizely.track(e,this.userId,this.attributes,r)},t.prototype.setForcedDecision=function(e,r){var n,i=e.flagKey,o=(n=e.ruleKey)!==null&&n!==void 0?n:G.FORCED_DECISION_NULL_RULE_KEY,a={variationKey:r.variationKey};return this.forcedDecisionsMap[i]||(this.forcedDecisionsMap[i]={}),this.forcedDecisionsMap[i][o]=a,!0},t.prototype.getForcedDecision=function(e){return this.findForcedDecision(e)},t.prototype.removeForcedDecision=function(e){var r,n=(r=e.ruleKey)!==null&&r!==void 0?r:G.FORCED_DECISION_NULL_RULE_KEY,i=e.flagKey,o=!1;return this.forcedDecisionsMap.hasOwnProperty(i)&&(this.forcedDecisionsMap[i].hasOwnProperty(n)&&(delete this.forcedDecisionsMap[i][n],o=!0),Object.keys(this.forcedDecisionsMap[i]).length===0&&delete this.forcedDecisionsMap[i]),o},t.prototype.removeAllForcedDecisions=function(){return this.forcedDecisionsMap={},!0},t.prototype.findForcedDecision=function(e){var r,n=(r=e.ruleKey)!==null&&r!==void 0?r:G.FORCED_DECISION_NULL_RULE_KEY,i=e.flagKey;if(this.forcedDecisionsMap.hasOwnProperty(e.flagKey)){var o=this.forcedDecisionsMap[i];if(o.hasOwnProperty(n))return{variationKey:o[n].variationKey}}return null},t.prototype.cloneUserContext=function(){var e=new t({optimizely:this.getOptimizely(),userId:this.getUserId(),attributes:this.getAttributes()});return Object.keys(this.forcedDecisionsMap).length>0&&(e.forcedDecisionsMap=Z({},this.forcedDecisionsMap)),e},t}(),pr=["and","or","not"];function Ee(t,e){if(Array.isArray(t)){var r=t[0],n=t.slice(1);switch(typeof r=="string"&&pr.indexOf(r)===-1&&(r="or",n=t),r){case"and":return function(i,o){var a=!1;if(Array.isArray(i)){for(var u=0;u<i.length;u++){var s=Ee(i[u],o);if(s===!1)return!1;s===null&&(a=!0)}return!a||null}return null}(n,e);case"not":return function(i,o){if(Array.isArray(i)&&i.length>0){var a=Ee(i[0],o);return a===null?null:!a}return null}(n,e);default:return function(i,o){var a=!1;if(Array.isArray(i)){for(var u=0;u<i.length;u++){var s=Ee(i[u],o);if(s===!0)return!0;s===null&&(a=!0)}return!!a&&null}return null}(n,e)}}return e(t)}var Oo=function(){function t(e,r){var n,i;this.sdkKey=(n=e.sdkKey)!==null&&n!==void 0?n:"",this.environmentKey=(i=e.environmentKey)!==null&&i!==void 0?i:"",this.attributes=e.attributes,this.audiences=t.getAudiences(e),this.events=e.events,this.revision=e.revision;var o=(e.featureFlags||[]).reduce(function(u,s){return u[s.id]=s.variables,u},{}),a=t.getExperimentsMapById(e,o);this.experimentsMap=t.getExperimentsKeyMap(a),this.featuresMap=t.getFeaturesMap(e,o,a),this.datafile=r}return t.prototype.getDatafile=function(){return this.datafile},t.getAudiences=function(e){var r=[],n=[];return(e.typedAudiences||[]).forEach(function(i){r.push({id:i.id,conditions:JSON.stringify(i.conditions),name:i.name}),n.push(i.id)}),(e.audiences||[]).forEach(function(i){n.indexOf(i.id)===-1&&i.id!="$opt_dummy_audience"&&r.push({id:i.id,conditions:JSON.stringify(i.conditions),name:i.name})}),r},t.getSerializedAudiences=function(e,r){var n="";if(e){var i="";e.forEach(function(o){var a="";if(o instanceof Array)a="("+(a=t.getSerializedAudiences(o,r))+")";else if(pr.indexOf(o)>-1)i=o.toUpperCase();else{var u=r[o]?r[o].name:o;n||i==="NOT"?(i=i===""?"OR":i,n=n===""?i+' "'+r[o].name+'"':n.concat(" "+i+' "'+u+'"')):n='"'+u+'"'}a!==""&&(n!==""||i==="NOT"?(i=i===""?"OR":i,n=n===""?i+" "+a:n.concat(" "+i+" "+a)):n=n.concat(a))})}return n},t.getExperimentAudiences=function(e,r){return e.audienceConditions?t.getSerializedAudiences(e.audienceConditions,r.audiencesById):""},t.mergeFeatureVariables=function(e,r,n,i,o){var a=(e[n]||[]).reduce(function(u,s){return u[s.key]={id:s.id,key:s.key,type:s.type,value:s.defaultValue},u},{});return(i||[]).forEach(function(u){var s=r[u.id],l={id:u.id,key:s.key,type:s.type,value:o?u.value:s.defaultValue};a[s.key]=l}),a},t.getVariationsMap=function(e,r,n,i){return e.reduce(function(o,a){var u=t.mergeFeatureVariables(r,n,i,a.variables,a.featureEnabled);return o[a.key]={id:a.id,key:a.key,featureEnabled:a.featureEnabled,variablesMap:u},o},{})},t.getVariableIdMap=function(e){return(e.featureFlags||[]).reduce(function(r,n){return n.variables.forEach(function(i){r[i.id]=i}),r},{})},t.getDeliveryRules=function(e,r,n,i){var o=t.getVariableIdMap(e);return i.map(function(a){return{id:a.id,key:a.key,audiences:t.getExperimentAudiences(a,e),variationsMap:t.getVariationsMap(a.variations,r,o,n)}})},t.getRolloutExperimentIds=function(e){var r=[];return(e||[]).forEach(function(n){n.experiments.forEach(function(i){r.push(i.id)})}),r},t.getExperimentsMapById=function(e,r){var n=t.getVariableIdMap(e),i=this.getRolloutExperimentIds(e.rollouts);return(e.experiments||[]).reduce(function(o,a){if(i.indexOf(a.id)===-1){var u=e.experimentFeatureMap[a.id],s="";u&&u.length>0&&(s=u[0]);var l=t.getVariationsMap(a.variations,r,n,s.toString());o[a.id]={id:a.id,key:a.key,audiences:t.getExperimentAudiences(a,e),variationsMap:l}}return o},{})},t.getExperimentsKeyMap=function(e){var r={};for(var n in e){var i=e[n];r[i.key]=i}return r},t.getFeaturesMap=function(e,r,n){var i={};return e.featureFlags.forEach(function(o){var a={},u=[];o.experimentIds.forEach(function(f){var p=n[f];p&&(a[p.key]=p),u.push(n[f])});var s=(o.variables||[]).reduce(function(f,p){return f[p.key]={id:p.id,key:p.key,type:p.type,value:p.defaultValue},f},{}),l=[],c=e.rolloutIdMap[o.rolloutId];c&&(l=t.getDeliveryRules(e,r,o.id,c.experiments)),i[o.key]={id:o.id,key:o.key,experimentRules:u,deliveryRules:l,experimentsMap:a,variablesMap:s}}),i},t}(),To=Math.pow(2,53),h={assign:function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(!t)return{};if(typeof Object.assign=="function")return Object.assign.apply(Object,ft([t],e));for(var n=Object(t),i=0;i<e.length;i++){var o=e[i];if(o!=null)for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(n[a]=o[a])}return n},currentTimestamp:function(){return Math.round(new Date().getTime())},isSafeInteger:function(t){return typeof t=="number"&&Math.abs(t)<=To},keyBy:function(t,e){return t?I.keyBy(t,function(r){return r[e]}):{}},uuid:I.generateUUID,isNumber:function(t){return typeof t=="number"}},L="PROJECT_CONFIG",No=function(t,e){e===void 0&&(e=null);var r,n,i,o,a=(r=t,(o=h.assign({},r)).audiences=(r.audiences||[]).map(function(u){return h.assign({},u)}),o.experiments=(r.experiments||[]).map(function(u){return h.assign({},u)}),o.featureFlags=(r.featureFlags||[]).map(function(u){return h.assign({},u)}),o.groups=(r.groups||[]).map(function(u){var s=h.assign({},u);return s.experiments=(u.experiments||[]).map(function(l){return h.assign({},l)}),s}),o.rollouts=(r.rollouts||[]).map(function(u){var s=h.assign({},u);return s.experiments=(u.experiments||[]).map(function(l){return h.assign({},l)}),s}),o.environmentKey=(n=r.environmentKey)!==null&&n!==void 0?n:"",o.sdkKey=(i=r.sdkKey)!==null&&i!==void 0?i:"",o);return a.__datafileStr=e===null?JSON.stringify(t):e,(a.audiences||[]).forEach(function(u){u.conditions=JSON.parse(u.conditions)}),a.audiencesById=h.keyBy(a.audiences,"id"),h.assign(a.audiencesById,h.keyBy(a.typedAudiences,"id")),a.attributeKeyMap=h.keyBy(a.attributes,"key"),a.eventKeyMap=h.keyBy(a.events,"key"),a.groupIdMap=h.keyBy(a.groups,"id"),Object.keys(a.groupIdMap||{}).forEach(function(u){(a.groupIdMap[u].experiments||[]).forEach(function(s){a.experiments.push(h.assign(s,{groupId:u}))})}),a.rolloutIdMap=h.keyBy(a.rollouts||[],"id"),I.objectValues(a.rolloutIdMap||{}).forEach(function(u){(u.experiments||[]).forEach(function(s){a.experiments.push(s),s.variationKeyMap=h.keyBy(s.variations,"key")})}),a.experimentKeyMap=h.keyBy(a.experiments,"key"),a.experimentIdMap=h.keyBy(a.experiments,"id"),a.variationIdMap={},a.variationVariableUsageMap={},(a.experiments||[]).forEach(function(u){u.variationKeyMap=h.keyBy(u.variations,"key"),h.assign(a.variationIdMap,h.keyBy(u.variations,"id")),I.objectValues(u.variationKeyMap||{}).forEach(function(s){s.variables&&(a.variationVariableUsageMap[s.id]=h.keyBy(s.variables,"id"))})}),a.experimentFeatureMap={},a.featureKeyMap=h.keyBy(a.featureFlags||[],"key"),I.objectValues(a.featureKeyMap||{}).forEach(function(u){u.variables.forEach(function(s){s.type===M.STRING&&s.subType===M.JSON&&(s.type=M.JSON,delete s.subType)}),u.variableKeyMap=h.keyBy(u.variables,"key"),(u.experimentIds||[]).forEach(function(s){a.experimentFeatureMap[s]?a.experimentFeatureMap[s].push(u.id):a.experimentFeatureMap[s]=[u.id]})}),a.flagRulesMap={},(a.featureFlags||[]).forEach(function(u){var s=[];u.experimentIds.forEach(function(c){var f=a.experimentIdMap[c];f&&s.push(f)});var l=a.rolloutIdMap[u.rolloutId];l&&s.push.apply(s,l.experiments),a.flagRulesMap[u.key]=s}),a.flagVariationsMap={},I.objectEntries(a.flagRulesMap||{}).forEach(function(u){var s=u[0],l=u[1],c=[];l.forEach(function(f){f.variations.forEach(function(p){I.find(c,function(g){return g.id===p.id})||c.push(p)})}),a.flagVariationsMap[s]=c}),a},gr=function(t,e){var r=t.experimentIdMap[e];if(!r)throw new Error(I.sprintf(_.INVALID_EXPERIMENT_ID,L,e));return r.layerId},vr=function(t,e,r){var n=t.attributeKeyMap[e],i=e.indexOf("$opt_")===0;return n?(i&&r.log(d.WARNING,"Attribute %s unexpectedly has reserved prefix %s; using attribute ID instead of reserved attribute name.",e,"$opt_"),n.id):i?e:(r.log(d.DEBUG,_.UNRECOGNIZED_ATTRIBUTE,L,e),null)},hr=function(t,e){var r=t.eventKeyMap[e];return r?r.id:null},_r=function(t,e){var r=t.experimentKeyMap[e];if(!r)throw new Error(I.sprintf(_.INVALID_EXPERIMENT_KEY,L,e));return r.status},Ir=function(t,e){return t.variationIdMap.hasOwnProperty(e)?t.variationIdMap[e].key:null},pt=function(t,e){if(t.experimentKeyMap.hasOwnProperty(e)){var r=t.experimentKeyMap[e];if(r)return r}throw new Error(I.sprintf(_.EXPERIMENT_KEY_NOT_IN_DATAFILE,L,e))},Ao=function(t,e){var r=t.experimentIdMap[e];if(!r)throw new Error(I.sprintf(_.INVALID_EXPERIMENT_ID,L,e));return r.trafficAllocation},So=function(t,e,r){if(t.experimentIdMap.hasOwnProperty(e)){var n=t.experimentIdMap[e];if(n)return n}return r.log(d.ERROR,_.INVALID_EXPERIMENT_ID,L,e),null},yr=function(t,e,r){if(!t)return null;var n=t.flagVariationsMap[e],i=I.find(n,function(o){return o.key===r});return i||null},gt=function(t,e,r){if(t.featureKeyMap.hasOwnProperty(e)){var n=t.featureKeyMap[e];if(n)return n}return r.log(d.ERROR,_.FEATURE_NOT_IN_DATAFILE,L,e),null},mr=function(t){return t.__datafileStr},Rr=function(t){var e;try{e=_o(t.datafile)}catch(n){return{configObj:null,error:n}}if(t.jsonSchemaValidator)try{t.jsonSchemaValidator.validate(e),t.logger.log(d.INFO,E.VALID_DATAFILE,L)}catch(n){return{configObj:null,error:n}}else t.logger.log(d.INFO,E.SKIPPING_JSON_VALIDATION,L);var r=[e];return typeof t.datafile=="string"&&r.push(t.datafile),{configObj:No.apply(void 0,r),error:null}},Or=function(t){return!!t.sendFlagDecisions},De=O.getLogger();function oe(t,e){return t instanceof Error?t.message:e||"Unknown error"}var Lo=function(){function t(e){this.updateListeners=[],this.configObj=null,this.optimizelyConfigObj=null,this.datafileManager=null;try{if(this.jsonSchemaValidator=e.jsonSchemaValidator,!e.datafile&&!e.sdkKey){var r=new Error(I.sprintf(_.DATAFILE_AND_SDK_KEY_MISSING,"PROJECT_CONFIG_MANAGER"));return this.readyPromise=Promise.resolve({success:!1,reason:oe(r)}),void De.error(r)}var n=null;e.datafile&&(n=this.handleNewDatafile(e.datafile)),e.sdkKey&&e.datafileManager?(this.datafileManager=e.datafileManager,this.datafileManager.start(),this.readyPromise=this.datafileManager.onReady().then(this.onDatafileManagerReadyFulfill.bind(this),this.onDatafileManagerReadyReject.bind(this)),this.datafileManager.on("update",this.onDatafileManagerUpdate.bind(this))):this.configObj?this.readyPromise=Promise.resolve({success:!0}):this.readyPromise=Promise.resolve({success:!1,reason:oe(n,"Invalid datafile")})}catch(i){De.error(i),this.readyPromise=Promise.resolve({success:!1,reason:oe(i,"Error in initialize")})}}return t.prototype.onDatafileManagerReadyFulfill=function(){if(this.datafileManager){var e=this.handleNewDatafile(this.datafileManager.get());return e?{success:!1,reason:oe(e)}:{success:!0}}return{success:!1,reason:oe(null,"Datafile manager is not provided")}},t.prototype.onDatafileManagerReadyReject=function(e){return{success:!1,reason:oe(e,"Failed to become ready")}},t.prototype.onDatafileManagerUpdate=function(){this.datafileManager&&this.handleNewDatafile(this.datafileManager.get())},t.prototype.handleNewDatafile=function(e){var r=Rr({datafile:e,jsonSchemaValidator:this.jsonSchemaValidator,logger:De}),n=r.configObj,i=r.error;if(i)De.error(i);else{var o=this.configObj?this.configObj.revision:"null";n&&o!==n.revision&&(this.configObj=n,this.optimizelyConfigObj=null,this.updateListeners.forEach(function(a){return a(n)}))}return i},t.prototype.getConfig=function(){return this.configObj},t.prototype.getOptimizelyConfig=function(){var e,r;return!this.optimizelyConfigObj&&this.configObj&&(this.optimizelyConfigObj=(e=this.configObj,r=mr(this.configObj),new Oo(e,r))),this.optimizelyConfigObj},t.prototype.onReady=function(){return this.readyPromise},t.prototype.onUpdate=function(e){var r=this;return this.updateListeners.push(e),function(){var n=r.updateListeners.indexOf(e);n>-1&&r.updateListeners.splice(n,1)}},t.prototype.stop=function(){this.datafileManager&&this.datafileManager.stop(),this.updateListeners=[]},t}(),Do=Math.pow(2,32),Tr=function(t){var e=[],r=t.experimentIdMap[t.experimentId].groupId;if(r){var n=t.groupIdMap[r];if(!n)throw new Error(I.sprintf(_.INVALID_GROUP_ID,"BUCKETER",r));if(n.policy==="random"){var i=Uo(n,t.bucketingId,t.userId,t.logger);if(i===null)return t.logger.log(d.INFO,E.USER_NOT_IN_ANY_EXPERIMENT,"BUCKETER",t.userId,r),e.push([E.USER_NOT_IN_ANY_EXPERIMENT,"BUCKETER",t.userId,r]),{result:null,reasons:e};if(i!==t.experimentId)return t.logger.log(d.INFO,E.USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",t.userId,t.experimentKey,r),e.push([E.USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",t.userId,t.experimentKey,r]),{result:null,reasons:e};t.logger.log(d.INFO,E.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",t.userId,t.experimentKey,r),e.push([E.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",t.userId,t.experimentKey,r])}}var o=""+t.bucketingId+t.experimentId,a=Ar(o);t.logger.log(d.DEBUG,E.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,"BUCKETER",a,t.userId),e.push([E.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,"BUCKETER",a,t.userId]);var u=Nr(a,t.trafficAllocationConfig);return u===null||t.variationIdMap[u]?{result:u,reasons:e}:(u&&(t.logger.log(d.WARNING,E.INVALID_VARIATION_ID,"BUCKETER"),e.push([E.INVALID_VARIATION_ID,"BUCKETER"])),{result:null,reasons:e})},Uo=function(t,e,r,n){var i=""+e+t.id,o=Ar(i);n.log(d.DEBUG,E.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,"BUCKETER",o,r);var a=t.trafficAllocation;return Nr(o,a)},Nr=function(t,e){for(var r=0;r<e.length;r++)if(t<e[r].endOfRange)return e[r].entityId;return null},Ar=function(t){try{var e=Ki.v3(t,1)/Do;return Math.floor(1e4*e)}catch(r){throw new Error(I.sprintf(_.INVALID_BUCKETING_ID,"BUCKETER",t,r.message))}},Ue=O.getLogger();function Sr(t){return/^\d+$/.test(t)}function z(t){var e=t.indexOf("-"),r=t.indexOf("+");return!(e<0)&&(r<0||e<r)}function Lr(t){var e=t.indexOf("-"),r=t.indexOf("+");return!(r<0)&&(e<0||r<e)}function Dr(t){var e=t,r="";if(function(u){return/\s/.test(u)}(t))return Ue.warn(E.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",t),null;if(z(t)?(e=t.substring(0,t.indexOf("-")),r=t.substring(t.indexOf("-")+1)):Lr(t)&&(e=t.substring(0,t.indexOf("+")),r=t.substring(t.indexOf("+")+1)),typeof e!="string"||typeof r!="string")return null;var n=e.split(".").length-1;if(n>2)return Ue.warn(E.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",t),null;var i=e.split(".");if(i.length!=n+1)return Ue.warn(E.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",t),null;for(var o=0,a=i;o<a.length;o++)if(!Sr(a[o]))return Ue.warn(E.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",t),null;return r&&i.push(r),i}var D="CUSTOM_ATTRIBUTE_CONDITION_EVALUATOR",U=O.getLogger(),bo=["exact","exists","gt","ge","lt","le","substring","semver_eq","semver_lt","semver_le","semver_gt","semver_ge"],F={};function Ur(t){return typeof t=="string"||typeof t=="boolean"||h.isNumber(t)}function br(t,e){var r=t.value,n=typeof r,i=t.name,o=e[i],a=typeof o;return!Ur(r)||h.isNumber(r)&&!h.isSafeInteger(r)?(U.warn(E.UNEXPECTED_CONDITION_VALUE,D,JSON.stringify(t)),null):o===null?(U.debug(E.UNEXPECTED_TYPE_NULL,D,JSON.stringify(t),i),null):Ur(o)&&n===a?h.isNumber(o)&&!h.isSafeInteger(o)?(U.warn(E.OUT_OF_BOUNDS,D,JSON.stringify(t),i),null):r===o:(U.warn(E.UNEXPECTED_TYPE,D,JSON.stringify(t),a,i),null)}function be(t,e){var r=t.name,n=e[r],i=typeof n,o=t.value;return o!==null&&h.isSafeInteger(o)?n===null?(U.debug(E.UNEXPECTED_TYPE_NULL,D,JSON.stringify(t),r),!1):h.isNumber(n)?!!h.isSafeInteger(n)||(U.warn(E.OUT_OF_BOUNDS,D,JSON.stringify(t),r),!1):(U.warn(E.UNEXPECTED_TYPE,D,JSON.stringify(t),i,r),!1):(U.warn(E.UNEXPECTED_CONDITION_VALUE,D,JSON.stringify(t)),!1)}function pe(t,e){var r=t.name,n=e[r],i=typeof n,o=t.value;return typeof o!="string"?(U.warn(E.UNEXPECTED_CONDITION_VALUE,D,JSON.stringify(t)),null):n===null?(U.debug(E.UNEXPECTED_TYPE_NULL,D,JSON.stringify(t),r),null):typeof n!="string"?(U.warn(E.UNEXPECTED_TYPE,D,JSON.stringify(t),i,r),null):function(a,u){var s=Dr(u),l=Dr(a);if(!s||!l)return null;for(var c=s.length,f=0;f<l.length;f++){if(c<=f)return z(a)||Lr(a)?1:-1;if(Sr(s[f])){var p=parseInt(s[f]),g=parseInt(l[f]);if(p>g)return 1;if(p<g)return-1}else{if(s[f]<l[f])return z(a)&&!z(u)?1:-1;if(s[f]>l[f])return!z(a)&&z(u)?-1:1}}return z(u)&&!z(a)?-1:0}(o,n)}F.exact=br,F.exists=function(t,e){var r=e[t.name];return r!=null},F.gt=function(t,e){var r=e[t.name],n=t.value;return!be(t,e)||n===null?null:r>n},F.ge=function(t,e){var r=e[t.name],n=t.value;return!be(t,e)||n===null?null:r>=n},F.lt=function(t,e){var r=e[t.name],n=t.value;return!be(t,e)||n===null?null:r<n},F.le=function(t,e){var r=e[t.name],n=t.value;return!be(t,e)||n===null?null:r<=n},F.substring=function(t,e){var r=t.name,n=e[t.name],i=typeof n,o=t.value;return typeof o!="string"?(U.warn(E.UNEXPECTED_CONDITION_VALUE,D,JSON.stringify(t)),null):n===null?(U.debug(E.UNEXPECTED_TYPE_NULL,D,JSON.stringify(t),r),null):typeof n!="string"?(U.warn(E.UNEXPECTED_TYPE,D,JSON.stringify(t),i,r),null):n.indexOf(o)!==-1},F.semver_eq=function(t,e){var r=pe(t,e);return r===null?null:r===0},F.semver_gt=function(t,e){var r=pe(t,e);return r===null?null:r>0},F.semver_ge=function(t,e){var r=pe(t,e);return r===null?null:r>=0},F.semver_lt=function(t,e){var r=pe(t,e);return r===null?null:r<0},F.semver_le=function(t,e){var r=pe(t,e);return r===null?null:r<=0};var Co=Object.freeze({__proto__:null,evaluate:function(t,e){var r=t.match;if(r!==void 0&&bo.indexOf(r)===-1)return U.warn(E.UNKNOWN_MATCH_TYPE,D,JSON.stringify(t)),null;var n=t.name;return e.hasOwnProperty(n)||r=="exists"?(r&&F[r]||br)(t,e):(U.debug(E.MISSING_ATTRIBUTE_VALUE,D,JSON.stringify(t),n),null)}}),Ce=O.getLogger(),Vo=function(){function t(e){this.typeToEvaluatorMap=h.assign({},e,{custom_attribute:Co})}return t.prototype.evaluate=function(e,r,n){var i=this;return n===void 0&&(n={}),!e||e.length===0?!0:!!Ee(e,function(o){var a=r[o];if(a){Ce.log(d.DEBUG,E.EVALUATING_AUDIENCE,"AUDIENCE_EVALUATOR",o,JSON.stringify(a.conditions));var u=Ee(a.conditions,i.evaluateConditionWithUserAttributes.bind(i,n)),s=u===null?"UNKNOWN":u.toString().toUpperCase();return Ce.log(d.DEBUG,E.AUDIENCE_EVALUATION_RESULT,"AUDIENCE_EVALUATOR",o,s),u}return null})},t.prototype.evaluateConditionWithUserAttributes=function(e,r){var n=this.typeToEvaluatorMap[r.type];if(!n)return Ce.log(d.WARNING,E.UNKNOWN_CONDITION_TYPE,"AUDIENCE_EVALUATOR",JSON.stringify(r)),null;try{return n.evaluate(r,e)}catch(i){Ce.log(d.ERROR,_.CONDITION_EVALUATOR_ERROR,"AUDIENCE_EVALUATOR",r.type,i.message)}return null},t}();function Cr(t){return typeof t=="string"&&t!==""}var v="DECISION_SERVICE",Po=function(){function t(e){var r;this.audienceEvaluator=(r=e.UNSTABLE_conditionEvaluators,new Vo(r)),this.forcedVariationMap={},this.logger=e.logger,this.userProfileService=e.userProfileService||null}return t.prototype.getVariation=function(e,r,n,i){i===void 0&&(i={});var o=n.getUserId(),a=n.getAttributes(),u=this.getBucketingId(o,a),s=[],l=r.key;if(!this.checkIfExperimentIsActive(e,l))return this.logger.log(d.INFO,E.EXPERIMENT_NOT_RUNNING,v,l),s.push([E.EXPERIMENT_NOT_RUNNING,v,l]),{result:null,reasons:s};var c=this.getForcedVariation(e,l,o);s.push.apply(s,c.reasons);var f=c.result;if(f)return{result:f,reasons:s};var p=this.getWhitelistedVariation(r,o);s.push.apply(s,p.reasons);var g=p.result;if(g)return{result:g.key,reasons:s};var y=i[H.IGNORE_USER_PROFILE_SERVICE],m=this.resolveExperimentBucketMap(o,a);if(!y&&(g=this.getStoredVariation(e,r,o,m)))return this.logger.log(d.INFO,E.RETURNING_STORED_VARIATION,v,g.key,l,o),s.push([E.RETURNING_STORED_VARIATION,v,g.key,l,o]),{result:g.key,reasons:s};var R=this.checkIfUserIsInAudience(e,r,dt.EXPERIMENT,a,"");if(s.push.apply(s,R.reasons),!R.result)return this.logger.log(d.INFO,E.USER_NOT_IN_EXPERIMENT,v,o,l),s.push([E.USER_NOT_IN_EXPERIMENT,v,o,l]),{result:null,reasons:s};var C=this.buildBucketerParams(e,r,u,o),x=Tr(C);s.push.apply(s,x.reasons);var V=x.result;return V&&(g=e.variationIdMap[V]),g?(this.logger.log(d.INFO,E.USER_HAS_VARIATION,v,o,g.key,l),s.push([E.USER_HAS_VARIATION,v,o,g.key,l]),y||this.saveUserProfile(r,g,o,m),{result:g.key,reasons:s}):(this.logger.log(d.DEBUG,E.USER_HAS_NO_VARIATION,v,o,l),s.push([E.USER_HAS_NO_VARIATION,v,o,l]),{result:null,reasons:s})},t.prototype.resolveExperimentBucketMap=function(e,r){r=r||{};var n=this.getUserProfile(e)||{},i=r[G.STICKY_BUCKETING_KEY];return h.assign({},n.experiment_bucket_map,i)},t.prototype.checkIfExperimentIsActive=function(e,r){return function(n,i){return _r(n,i)==="Running"}(e,r)},t.prototype.getWhitelistedVariation=function(e,r){var n=[];if(e.forcedVariations&&e.forcedVariations.hasOwnProperty(r)){var i=e.forcedVariations[r];return e.variationKeyMap.hasOwnProperty(i)?(this.logger.log(d.INFO,E.USER_FORCED_IN_VARIATION,v,r,i),n.push([E.USER_FORCED_IN_VARIATION,v,r,i]),{result:e.variationKeyMap[i],reasons:n}):(this.logger.log(d.ERROR,E.FORCED_BUCKETING_FAILED,v,i,r),n.push([E.FORCED_BUCKETING_FAILED,v,i,r]),{result:null,reasons:n})}return{result:null,reasons:n}},t.prototype.checkIfUserIsInAudience=function(e,r,n,i,o){var a=[],u=function(c,f){var p=c.experimentIdMap[f];if(!p)throw new Error(I.sprintf(_.INVALID_EXPERIMENT_ID,L,f));return p.audienceConditions||p.audienceIds}(e,r.id),s=e.audiencesById;this.logger.log(d.DEBUG,E.EVALUATING_AUDIENCES_COMBINED,v,n,o||r.key,JSON.stringify(u)),a.push([E.EVALUATING_AUDIENCES_COMBINED,v,n,o||r.key,JSON.stringify(u)]);var l=this.audienceEvaluator.evaluate(u,s,i);return this.logger.log(d.INFO,E.AUDIENCE_EVALUATION_RESULT_COMBINED,v,n,o||r.key,l.toString().toUpperCase()),a.push([E.AUDIENCE_EVALUATION_RESULT_COMBINED,v,n,o||r.key,l.toString().toUpperCase()]),{result:l,reasons:a}},t.prototype.buildBucketerParams=function(e,r,n,i){return{bucketingId:n,experimentId:r.id,experimentKey:r.key,experimentIdMap:e.experimentIdMap,experimentKeyMap:e.experimentKeyMap,groupIdMap:e.groupIdMap,logger:this.logger,trafficAllocationConfig:Ao(e,r.id),userId:i,variationIdMap:e.variationIdMap}},t.prototype.getStoredVariation=function(e,r,n,i){if(i.hasOwnProperty(r.id)){var o=i[r.id],a=o.variation_id;if(e.variationIdMap.hasOwnProperty(a))return e.variationIdMap[o.variation_id];this.logger.log(d.INFO,E.SAVED_VARIATION_NOT_FOUND,v,n,a,r.key)}return null},t.prototype.getUserProfile=function(e){var r={user_id:e,experiment_bucket_map:{}};if(!this.userProfileService)return r;try{return this.userProfileService.lookup(e)}catch(n){this.logger.log(d.ERROR,_.USER_PROFILE_LOOKUP_ERROR,v,e,n.message)}return null},t.prototype.saveUserProfile=function(e,r,n,i){if(this.userProfileService)try{i[e.id]={variation_id:r.id},this.userProfileService.save({user_id:n,experiment_bucket_map:i}),this.logger.log(d.INFO,E.SAVED_VARIATION,v,r.key,e.key,n)}catch(o){this.logger.log(d.ERROR,_.USER_PROFILE_SAVE_ERROR,v,n,o.message)}},t.prototype.getVariationForFeature=function(e,r,n,i){i===void 0&&(i={});var o=[],a=this.getVariationForFeatureExperiment(e,r,n,i);o.push.apply(o,a.reasons);var u=a.result;if(u.variation!==null)return{result:u,reasons:o};var s=this.getVariationForRollout(e,r,n);o.push.apply(o,s.reasons);var l=s.result,c=n.getUserId();return l.variation?(this.logger.log(d.DEBUG,E.USER_IN_ROLLOUT,v,c,r.key),o.push([E.USER_IN_ROLLOUT,v,c,r.key]),{result:l,reasons:o}):(this.logger.log(d.DEBUG,E.USER_NOT_IN_ROLLOUT,v,c,r.key),o.push([E.USER_NOT_IN_ROLLOUT,v,c,r.key]),{result:l,reasons:o})},t.prototype.getVariationForFeatureExperiment=function(e,r,n,i){i===void 0&&(i={});var o,a,u=[],s=null;if(r.experimentIds.length>0)for(a=0;a<r.experimentIds.length;a++){var l=So(e,r.experimentIds[a],this.logger);if(l&&(o=this.getVariationFromExperimentRule(e,r.key,l,n,i),u.push.apply(u,o.reasons),s=o.result)){var c=null;return(c=l.variationKeyMap[s])||(c=yr(e,r.key,s)),{result:{experiment:l,variation:c,decisionSource:S.FEATURE_TEST},reasons:u}}}else this.logger.log(d.DEBUG,E.FEATURE_HAS_NO_EXPERIMENTS,v,r.key),u.push([E.FEATURE_HAS_NO_EXPERIMENTS,v,r.key]);return{result:{experiment:null,variation:null,decisionSource:S.FEATURE_TEST},reasons:u}},t.prototype.getVariationForRollout=function(e,r,n){var i=[];if(!r.rolloutId)return this.logger.log(d.DEBUG,E.NO_ROLLOUT_EXISTS,v,r.key),i.push([E.NO_ROLLOUT_EXISTS,v,r.key]),{result:{experiment:null,variation:null,decisionSource:S.ROLLOUT},reasons:i};var o=e.rolloutIdMap[r.rolloutId];if(!o)return this.logger.log(d.ERROR,_.INVALID_ROLLOUT_ID,v,r.rolloutId,r.key),i.push([_.INVALID_ROLLOUT_ID,v,r.rolloutId,r.key]),{result:{experiment:null,variation:null,decisionSource:S.ROLLOUT},reasons:i};var a,u,s,l=o.experiments;if(l.length===0)return this.logger.log(d.ERROR,E.ROLLOUT_HAS_NO_EXPERIMENTS,v,r.rolloutId),i.push([E.ROLLOUT_HAS_NO_EXPERIMENTS,v,r.rolloutId]),{result:{experiment:null,variation:null,decisionSource:S.ROLLOUT},reasons:i};for(var c=0;c<l.length;){if(a=this.getVariationFromDeliveryRule(e,r.key,l,c,n),i.push.apply(i,a.reasons),s=a.result,u=a.skipToEveryoneElse,s)return{result:{experiment:e.experimentIdMap[l[c].id],variation:s,decisionSource:S.ROLLOUT},reasons:i};c=u?l.length-1:c+1}return{result:{experiment:null,variation:null,decisionSource:S.ROLLOUT},reasons:i}},t.prototype.getBucketingId=function(e,r){var n=e;return r!=null&&typeof r=="object"&&r.hasOwnProperty(G.BUCKETING_ID)&&(typeof r[G.BUCKETING_ID]=="string"?(n=r[G.BUCKETING_ID],this.logger.log(d.DEBUG,E.VALID_BUCKETING_ID,v,n)):this.logger.log(d.WARNING,E.BUCKETING_ID_NOT_STRING,v)),n},t.prototype.findValidatedForcedDecision=function(e,r,n,i){var o,a=[],u=r.getForcedDecision({flagKey:n,ruleKey:i}),s=null,l=r.getUserId();return e&&u&&(o=u.variationKey,(s=yr(e,n,o))?i?(this.logger.log(d.INFO,E.USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED,o,n,i,l),a.push([E.USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED,o,n,i,l])):(this.logger.log(d.INFO,E.USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED,o,n,l),a.push([E.USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED,o,n,l])):i?(this.logger.log(d.INFO,E.USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED_BUT_INVALID,n,i,l),a.push([E.USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED_BUT_INVALID,n,i,l])):(this.logger.log(d.INFO,E.USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED_BUT_INVALID,n,l),a.push([E.USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED_BUT_INVALID,n,l]))),{result:s,reasons:a}},t.prototype.removeForcedVariation=function(e,r,n){if(!e)throw new Error(I.sprintf(_.INVALID_USER_ID,v));if(!this.forcedVariationMap.hasOwnProperty(e))throw new Error(I.sprintf(_.USER_NOT_IN_FORCED_VARIATION,v,e));delete this.forcedVariationMap[e][r],this.logger.log(d.DEBUG,E.VARIATION_REMOVED_FOR_USER,v,n,e)},t.prototype.setInForcedVariationMap=function(e,r,n){this.forcedVariationMap.hasOwnProperty(e)||(this.forcedVariationMap[e]={}),this.forcedVariationMap[e][r]=n,this.logger.log(d.DEBUG,E.USER_MAPPED_TO_FORCED_VARIATION,v,n,r,e)},t.prototype.getForcedVariation=function(e,r,n){var i,o=[],a=this.forcedVariationMap[n];if(!a)return this.logger.log(d.DEBUG,E.USER_HAS_NO_FORCED_VARIATION,v,n),{result:null,reasons:o};try{var u=pt(e,r);if(!u.hasOwnProperty("id"))return this.logger.log(d.ERROR,_.IMPROPERLY_FORMATTED_EXPERIMENT,v,r),o.push([_.IMPROPERLY_FORMATTED_EXPERIMENT,v,r]),{result:null,reasons:o};i=u.id}catch(c){return this.logger.log(d.ERROR,c.message),o.push(c.message),{result:null,reasons:o}}var s=a[i];if(!s)return this.logger.log(d.DEBUG,E.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT,v,r,n),{result:null,reasons:o};var l=Ir(e,s);return l?(this.logger.log(d.DEBUG,E.USER_HAS_FORCED_VARIATION,v,l,r,n),o.push([E.USER_HAS_FORCED_VARIATION,v,l,r,n])):this.logger.log(d.DEBUG,E.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT,v,r,n),{result:l,reasons:o}},t.prototype.setForcedVariation=function(e,r,n,i){if(i!=null&&!Cr(i))return this.logger.log(d.ERROR,_.INVALID_VARIATION_KEY,v),!1;var o;try{var a=pt(e,r);if(!a.hasOwnProperty("id"))return this.logger.log(d.ERROR,_.IMPROPERLY_FORMATTED_EXPERIMENT,v,r),!1;o=a.id}catch(s){return this.logger.log(d.ERROR,s.message),!1}if(i==null)try{return this.removeForcedVariation(n,o,r),!0}catch(s){return this.logger.log(d.ERROR,s.message),!1}var u=function(s,l,c){var f=s.experimentKeyMap[l];return f.variationKeyMap.hasOwnProperty(c)?f.variationKeyMap[c].id:null}(e,r,i);if(!u)return this.logger.log(d.ERROR,_.NO_VARIATION_FOR_EXPERIMENT_KEY,v,i,r),!1;try{return this.setInForcedVariationMap(n,o,u),!0}catch(s){return this.logger.log(d.ERROR,s.message),!1}},t.prototype.getVariationFromExperimentRule=function(e,r,n,i,o){o===void 0&&(o={});var a=[],u=this.findValidatedForcedDecision(e,i,r,n.key);a.push.apply(a,u.reasons);var s=u.result;if(s)return{result:s.key,reasons:a};var l=this.getVariation(e,n,i,o);return a.push.apply(a,l.reasons),{result:l.result,reasons:a}},t.prototype.getVariationFromDeliveryRule=function(e,r,n,i,o){var a=[],u=!1,s=n[i],l=this.findValidatedForcedDecision(e,o,r,s.key);a.push.apply(a,l.reasons);var c=l.result;if(c)return{result:c,reasons:a,skipToEveryoneElse:u};var f,p,g,y,m,R=o.getUserId(),C=o.getAttributes(),x=this.getBucketingId(R,C),V=i===n.length-1,P=V?"Everyone Else":i+1,W=null,Y=this.checkIfUserIsInAudience(e,s,dt.RULE,C,P);return a.push.apply(a,Y.reasons),Y.result?(this.logger.log(d.DEBUG,E.USER_MEETS_CONDITIONS_FOR_TARGETING_RULE,v,R,P),a.push([E.USER_MEETS_CONDITIONS_FOR_TARGETING_RULE,v,R,P]),p=this.buildBucketerParams(e,s,x,R),g=Tr(p),a.push.apply(a,g.reasons),(f=g.result)&&(m=f,W=(y=e).variationIdMap.hasOwnProperty(m)?y.variationIdMap[m]:null),W?(this.logger.log(d.DEBUG,E.USER_BUCKETED_INTO_TARGETING_RULE,v,R,P),a.push([E.USER_BUCKETED_INTO_TARGETING_RULE,v,R,P])):V||(this.logger.log(d.DEBUG,E.USER_NOT_BUCKETED_INTO_TARGETING_RULE,v,R,P),a.push([E.USER_NOT_BUCKETED_INTO_TARGETING_RULE,v,R,P]),u=!0)):(this.logger.log(d.DEBUG,E.USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE,v,R,P),a.push([E.USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE,v,R,P])),{result:W,reasons:a,skipToEveryoneElse:u}},t}();function Vr(t,e){if(t.hasOwnProperty("revenue")){var r=t.revenue,n=void 0;return typeof r=="string"?(n=parseInt(r),isNaN(n)?(e.log(d.INFO,E.FAILED_TO_PARSE_REVENUE,"EVENT_TAG_UTILS",r),null):(e.log(d.INFO,E.PARSED_REVENUE_VALUE,"EVENT_TAG_UTILS",n),n)):typeof r=="number"?(n=r,e.log(d.INFO,E.PARSED_REVENUE_VALUE,"EVENT_TAG_UTILS",n),n):null}return null}function Pr(t,e){if(t.hasOwnProperty("value")){var r=t.value,n=void 0;return typeof r=="string"?(n=parseFloat(r),isNaN(n)?(e.log(d.INFO,E.FAILED_TO_PARSE_VALUE,"EVENT_TAG_UTILS",r),null):(e.log(d.INFO,E.PARSED_NUMERIC_VALUE,"EVENT_TAG_UTILS",n),n)):typeof r=="number"?(n=r,e.log(d.INFO,E.PARSED_NUMERIC_VALUE,"EVENT_TAG_UTILS",n),n):null}return null}function Mr(t,e){return typeof t=="string"&&(typeof e=="string"||typeof e=="boolean"||h.isNumber(e)&&h.isSafeInteger(e))}var Fr="https://logx.optimizely.com/v1/events";function xr(t){var e=t.attributes,r=t.userId,n=t.clientEngine,i=t.clientVersion,o=t.configObj,a=t.logger,u=!!o.anonymizeIP&&o.anonymizeIP,s=o.botFiltering,l={snapshots:[],visitor_id:r,attributes:[]},c={account_id:o.accountId,project_id:o.projectId,visitors:[l],revision:o.revision,client_name:n,client_version:i,anonymize_ip:u,enrich_decisions:!0};return e&&Object.keys(e||{}).forEach(function(f){if(Mr(f,e[f])){var p=vr(o,f,a);p&&c.visitors[0].attributes.push({entity_id:p,key:f,type:"custom",value:e[f]})}}),typeof s=="boolean"&&c.visitors[0].attributes.push({entity_id:G.BOT_FILTERING,key:G.BOT_FILTERING,type:"custom",value:s}),c}function Mo(t){var e,r,n,i,o,a,u,s,l,c=xr(t),f=(e=t.configObj,r=t.experimentId,n=t.variationId,i=t.ruleKey,o=t.ruleType,a=t.flagKey,u=t.enabled,s=r?gr(e,r):null,l=n?Ir(e,n):null,{decisions:[{campaign_id:s,experiment_id:r,variation_id:n,metadata:{flag_key:a,rule_key:i,rule_type:o,variation_key:l=l||"",enabled:u}}],events:[{entity_id:s,timestamp:h.currentTimestamp(),key:"campaign_activated",uuid:h.uuid()}]});return c.visitors[0].snapshots.push(f),{httpVerb:"POST",url:Fr,params:c}}function Fo(t){var e=xr(t),r=function(n,i,o,a){var u={events:[]},s={entity_id:hr(n,i),timestamp:h.currentTimestamp(),uuid:h.uuid(),key:i};if(a){var l=Vr(a,o);l!==null&&(s.revenue=l);var c=Pr(a,o);c!==null&&(s.value=c),s.tags=a}return u.events.push(s),u}(t.configObj,t.eventKey,t.logger,t.eventTags);return e.visitors[0].snapshots=[r],{httpVerb:"POST",url:Fr,params:e}}function vt(t){var e,r;return(r=(e=t.experiment)===null||e===void 0?void 0:e.key)!==null&&r!==void 0?r:""}function ht(t){var e,r;return(r=(e=t.variation)===null||e===void 0?void 0:e.key)!==null&&r!==void 0?r:""}function Ve(t){var e,r;return(r=(e=t.variation)===null||e===void 0?void 0:e.featureEnabled)!==null&&r!==void 0&&r}function kr(t){var e,r;return(r=(e=t.experiment)===null||e===void 0?void 0:e.id)!==null&&r!==void 0?r:null}function wr(t){var e,r;return(r=(e=t.variation)===null||e===void 0?void 0:e.id)!==null&&r!==void 0?r:null}var _t=O.getLogger("EVENT_BUILDER");function Br(t,e){var r=[];return e&&Object.keys(e||{}).forEach(function(n){if(Mr(n,e[n])){var i=vr(t,n,_t);i&&r.push({entityId:i,key:n,value:e[n]})}}),r}var It="USER_PROFILE_SERVICE_VALIDATOR",xo=function(){function t(e){var r,n=this,i=e.clientEngine;i||(e.logger.log(d.INFO,E.INVALID_CLIENT_ENGINE,"OPTIMIZELY",i),i="node-sdk"),this.clientEngine=i,this.clientVersion=e.clientVersion||"4.9.1",this.errorHandler=e.errorHandler,this.isOptimizelyConfigValid=e.isValidInstance,this.logger=e.logger;var o=(r=e.defaultDecideOptions)!==null&&r!==void 0?r:[];Array.isArray(o)||(this.logger.log(d.DEBUG,E.INVALID_DEFAULT_DECIDE_OPTIONS,"OPTIMIZELY"),o=[]);var a={};o.forEach(function(f){H[f]?a[f]=!0:n.logger.log(d.WARNING,E.UNRECOGNIZED_DECIDE_OPTION,"OPTIMIZELY",f)}),this.defaultDecideOptions=a,this.projectConfigManager=function(f){return new Lo(f)}({datafile:e.datafile,jsonSchemaValidator:e.jsonSchemaValidator,sdkKey:e.sdkKey,datafileManager:e.datafileManager}),this.disposeOnUpdate=this.projectConfigManager.onUpdate(function(f){n.logger.log(d.INFO,E.UPDATED_OPTIMIZELY_CONFIG,"OPTIMIZELY",f.revision,f.projectId),n.notificationCenter.sendNotifications(w.OPTIMIZELY_CONFIG_UPDATE)});var u,s=this.projectConfigManager.onReady(),l=null;if(e.userProfileService)try{(function(f){if(typeof f=="object"&&f!==null){if(typeof f.lookup!="function")throw new Error(I.sprintf(_.INVALID_USER_PROFILE_SERVICE,It,"Missing function 'lookup'"));if(typeof f.save!="function")throw new Error(I.sprintf(_.INVALID_USER_PROFILE_SERVICE,It,"Missing function 'save'"));return!0}throw new Error(I.sprintf(_.INVALID_USER_PROFILE_SERVICE,It))})(e.userProfileService)&&(l=e.userProfileService,this.logger.log(d.INFO,E.VALID_USER_PROFILE_SERVICE,"OPTIMIZELY"))}catch(f){this.logger.log(d.WARNING,f.message)}this.decisionService=(u={userProfileService:l,logger:this.logger,UNSTABLE_conditionEvaluators:e.UNSTABLE_conditionEvaluators},new Po(u)),this.notificationCenter=e.notificationCenter,this.eventProcessor=e.eventProcessor;var c=this.eventProcessor.start();this.readyPromise=Promise.all([s,c]).then(function(f){return f[0]}),this.readyTimeouts={},this.nextReadyTimeoutId=0}return t.prototype.isValidInstance=function(){return this.isOptimizelyConfigValid&&!!this.projectConfigManager.getConfig()},t.prototype.activate=function(e,r,n){try{if(!this.isValidInstance())return this.logger.log(d.ERROR,E.INVALID_OBJECT,"OPTIMIZELY","activate"),null;if(!this.validateInputs({experiment_key:e,user_id:r},n))return this.notActivatingExperiment(e,r);var i=this.projectConfigManager.getConfig();if(!i)return null;try{var o=this.getVariation(e,r,n);if(o===null)return this.notActivatingExperiment(e,r);if(!function(s,l){return _r(s,l)==="Running"}(i,e))return this.logger.log(d.DEBUG,E.SHOULD_NOT_DISPATCH_ACTIVATE,"OPTIMIZELY",e),o;var a=pt(i,e),u={experiment:a,variation:a.variationKeyMap[o],decisionSource:S.EXPERIMENT};return this.sendImpressionEvent(u,"",r,!0,n),o}catch(s){return this.logger.log(d.ERROR,s.message),this.logger.log(d.INFO,E.NOT_ACTIVATING_USER,"OPTIMIZELY",r,e),this.errorHandler.handleError(s),null}}catch(s){return this.logger.log(d.ERROR,s.message),this.errorHandler.handleError(s),null}},t.prototype.sendImpressionEvent=function(e,r,n,i,o){var a=this.projectConfigManager.getConfig();if(a){var u=function(s){var l=s.configObj,c=s.decisionObj,f=s.userId,p=s.flagKey,g=s.enabled,y=s.userAttributes,m=s.clientEngine,R=s.clientVersion,C=c.decisionSource,x=vt(c),V=kr(c),P=ht(c),W=wr(c),Y=V!==null?gr(l,V):null;return{type:"impression",timestamp:h.currentTimestamp(),uuid:h.uuid(),user:{id:f,attributes:Br(l,y)},context:{accountId:l.accountId,projectId:l.projectId,revision:l.revision,clientName:m,clientVersion:R,anonymizeIP:l.anonymizeIP||!1,botFiltering:l.botFiltering},layer:{id:Y},experiment:{id:V,key:x},variation:{id:W,key:P},ruleKey:x,flagKey:p,ruleType:C,enabled:g}}({decisionObj:e,flagKey:r,enabled:i,userId:n,userAttributes:o,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:a});this.eventProcessor.process(u),this.emitNotificationCenterActivate(e,r,n,i,o)}},t.prototype.emitNotificationCenterActivate=function(e,r,n,i,o){var a=this.projectConfigManager.getConfig();if(a){var u,s=e.decisionSource,l=vt(e),c=kr(e),f=ht(e),p=wr(e);c!==null&&f!==""&&(u=a.experimentIdMap[c]);var g,y=Mo({attributes:o,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:a,experimentId:c,ruleKey:l,flagKey:r,ruleType:s,userId:n,enabled:i,variationId:p,logger:this.logger});u&&u.variationKeyMap&&f!==""&&(g=u.variationKeyMap[f]),this.notificationCenter.sendNotifications(w.ACTIVATE,{experiment:u,userId:n,attributes:o,variation:g,logEvent:y})}},t.prototype.track=function(e,r,n,i){try{if(!this.isValidInstance())return void this.logger.log(d.ERROR,E.INVALID_OBJECT,"OPTIMIZELY","track");if(!this.validateInputs({user_id:r,event_key:e},n,i))return;var o=this.projectConfigManager.getConfig();if(!o)return;if(!function(u,s){return u.eventKeyMap.hasOwnProperty(s)}(o,e))return this.logger.log(d.WARNING,E.EVENT_KEY_NOT_FOUND,"OPTIMIZELY",e),void this.logger.log(d.WARNING,E.NOT_TRACKING_USER,"OPTIMIZELY",r);var a=function(u){var s=u.configObj,l=u.userId,c=u.userAttributes,f=u.clientEngine,p=u.clientVersion,g=u.eventKey,y=u.eventTags,m=hr(s,g),R=y?Vr(y,_t):null,C=y?Pr(y,_t):null;return{type:"conversion",timestamp:h.currentTimestamp(),uuid:h.uuid(),user:{id:l,attributes:Br(s,c)},context:{accountId:s.accountId,projectId:s.projectId,revision:s.revision,clientName:f,clientVersion:p,anonymizeIP:s.anonymizeIP||!1,botFiltering:s.botFiltering},event:{id:m,key:g},revenue:R,value:C,tags:y}}({eventKey:e,eventTags:i=this.filterEmptyValues(i),userId:r,userAttributes:n,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:o});this.logger.log(d.INFO,E.TRACK_EVENT,"OPTIMIZELY",e,r),this.eventProcessor.process(a),this.emitNotificationCenterTrack(e,r,n,i)}catch(u){this.logger.log(d.ERROR,u.message),this.errorHandler.handleError(u),this.logger.log(d.ERROR,E.NOT_TRACKING_USER,"OPTIMIZELY",r)}},t.prototype.emitNotificationCenterTrack=function(e,r,n,i){try{var o=this.projectConfigManager.getConfig();if(!o)return;var a=Fo({attributes:n,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:o,eventKey:e,eventTags:i,logger:this.logger,userId:r});this.notificationCenter.sendNotifications(w.TRACK,{eventKey:e,userId:r,attributes:n,eventTags:i,logEvent:a})}catch(u){this.logger.log(d.ERROR,u.message),this.errorHandler.handleError(u)}},t.prototype.getVariation=function(e,r,n){try{if(!this.isValidInstance())return this.logger.log(d.ERROR,E.INVALID_OBJECT,"OPTIMIZELY","getVariation"),null;try{if(!this.validateInputs({experiment_key:e,user_id:r},n))return null;var i=this.projectConfigManager.getConfig();if(!i)return null;var o=i.experimentKeyMap[e];if(!o)return this.logger.log(d.DEBUG,_.INVALID_EXPERIMENT_KEY,"OPTIMIZELY",e),null;var a=this.decisionService.getVariation(i,o,this.createUserContext(r,n)).result,u=(s=i,l=o.id,s.experimentFeatureMap.hasOwnProperty(l)?Q.FEATURE_TEST:Q.AB_TEST);return this.notificationCenter.sendNotifications(w.DECISION,{type:u,userId:r,attributes:n||{},decisionInfo:{experimentKey:e,variationKey:a}}),a}catch(c){return this.logger.log(d.ERROR,c.message),this.errorHandler.handleError(c),null}}catch(c){return this.logger.log(d.ERROR,c.message),this.errorHandler.handleError(c),null}var s,l},t.prototype.setForcedVariation=function(e,r,n){if(!this.validateInputs({experiment_key:e,user_id:r}))return!1;var i=this.projectConfigManager.getConfig();if(!i)return!1;try{return this.decisionService.setForcedVariation(i,e,r,n)}catch(o){return this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o),!1}},t.prototype.getForcedVariation=function(e,r){if(!this.validateInputs({experiment_key:e,user_id:r}))return null;var n=this.projectConfigManager.getConfig();if(!n)return null;try{return this.decisionService.getForcedVariation(n,e,r).result}catch(i){return this.logger.log(d.ERROR,i.message),this.errorHandler.handleError(i),null}},t.prototype.validateInputs=function(e,r,n){try{if(e.hasOwnProperty("user_id")){var i=e.user_id;if(typeof i!="string"||i===null||i==="undefined")throw new Error(I.sprintf(_.INVALID_INPUT_FORMAT,"OPTIMIZELY","user_id"));delete e.user_id}return Object.keys(e).forEach(function(o){if(!Cr(e[o]))throw new Error(I.sprintf(_.INVALID_INPUT_FORMAT,"OPTIMIZELY",o))}),r&&function(o){if(typeof o!="object"||Array.isArray(o)||o===null)throw new Error(I.sprintf(_.INVALID_ATTRIBUTES,"ATTRIBUTES_VALIDATOR"));Object.keys(o).forEach(function(a){if(o[a]===void 0)throw new Error(I.sprintf(_.UNDEFINED_ATTRIBUTE,"ATTRIBUTES_VALIDATOR",a))})}(r),n&&function(o){if(typeof o!="object"||Array.isArray(o)||o===null)throw new Error(I.sprintf(_.INVALID_EVENT_TAGS,"EVENT_TAGS_VALIDATOR"))}(n),!0}catch(o){return this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o),!1}},t.prototype.notActivatingExperiment=function(e,r){return this.logger.log(d.INFO,E.NOT_ACTIVATING_USER,"OPTIMIZELY",r,e),null},t.prototype.filterEmptyValues=function(e){for(var r in e)!e.hasOwnProperty(r)||e[r]!==null&&e[r]!==void 0||delete e[r];return e},t.prototype.isFeatureEnabled=function(e,r,n){try{if(!this.isValidInstance())return this.logger.log(d.ERROR,E.INVALID_OBJECT,"OPTIMIZELY","isFeatureEnabled"),!1;if(!this.validateInputs({feature_key:e,user_id:r},n))return!1;var i=this.projectConfigManager.getConfig();if(!i)return!1;var o=gt(i,e,this.logger);if(!o)return!1;var a={},u=this.createUserContext(r,n),s=this.decisionService.getVariationForFeature(i,o,u).result,l=s.decisionSource,c=vt(s),f=ht(s),p=Ve(s);l===S.FEATURE_TEST&&(a={experimentKey:c,variationKey:f}),(l===S.FEATURE_TEST||l===S.ROLLOUT&&Or(i))&&this.sendImpressionEvent(s,o.key,r,p,n),p===!0?this.logger.log(d.INFO,E.FEATURE_ENABLED_FOR_USER,"OPTIMIZELY",e,r):(this.logger.log(d.INFO,E.FEATURE_NOT_ENABLED_FOR_USER,"OPTIMIZELY",e,r),p=!1);var g={featureKey:e,featureEnabled:p,source:s.decisionSource,sourceInfo:a};return this.notificationCenter.sendNotifications(w.DECISION,{type:Q.FEATURE,userId:r,attributes:n||{},decisionInfo:g}),p}catch(y){return this.logger.log(d.ERROR,y.message),this.errorHandler.handleError(y),!1}},t.prototype.getEnabledFeatures=function(e,r){var n=this;try{var i=[];if(!this.isValidInstance())return this.logger.log(d.ERROR,E.INVALID_OBJECT,"OPTIMIZELY","getEnabledFeatures"),i;if(!this.validateInputs({user_id:e}))return i;var o=this.projectConfigManager.getConfig();return o&&I.objectValues(o.featureKeyMap).forEach(function(a){n.isFeatureEnabled(a.key,e,r)&&i.push(a.key)}),i}catch(a){return this.logger.log(d.ERROR,a.message),this.errorHandler.handleError(a),[]}},t.prototype.getFeatureVariable=function(e,r,n,i){try{return this.isValidInstance()?this.getFeatureVariableForType(e,r,null,n,i):(this.logger.log(d.ERROR,E.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariable"),null)}catch(o){return this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o),null}},t.prototype.getFeatureVariableForType=function(e,r,n,i,o){if(!this.validateInputs({feature_key:e,variable_key:r,user_id:i},o))return null;var a=this.projectConfigManager.getConfig();if(!a)return null;var u=gt(a,e,this.logger);if(!u)return null;var s=function(y,m,R,C){var x=y.featureKeyMap[m];if(!x)return C.log(d.ERROR,_.FEATURE_NOT_IN_DATAFILE,L,m),null;var V=x.variableKeyMap[R];return V||(C.log(d.ERROR,_.VARIABLE_KEY_NOT_IN_DATAFILE,L,R,m),null)}(a,e,r,this.logger);if(!s)return null;if(n&&s.type!==n)return this.logger.log(d.WARNING,E.VARIABLE_REQUESTED_WITH_WRONG_TYPE,"OPTIMIZELY",n,s.type),null;var l=this.createUserContext(i,o),c=this.decisionService.getVariationForFeature(a,u,l).result,f=Ve(c),p=this.getFeatureVariableValueFromVariation(e,f,c.variation,s,i),g={};return c.decisionSource===S.FEATURE_TEST&&c.experiment!==null&&c.variation!==null&&(g={experimentKey:c.experiment.key,variationKey:c.variation.key}),this.notificationCenter.sendNotifications(w.DECISION,{type:Q.FEATURE_VARIABLE,userId:i,attributes:o||{},decisionInfo:{featureKey:e,featureEnabled:f,source:c.decisionSource,variableKey:r,variableValue:p,variableType:s.type,sourceInfo:g}}),p},t.prototype.getFeatureVariableValueFromVariation=function(e,r,n,i,o){var a=this.projectConfigManager.getConfig();if(!a)return null;var u=i.defaultValue;if(n!==null){var s=function(l,c,f,p){if(!c||!f)return null;if(!l.variationVariableUsageMap.hasOwnProperty(f.id))return p.log(d.ERROR,_.VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT,L,f.id),null;var g=l.variationVariableUsageMap[f.id][c.id];return g?g.value:null}(a,i,n,this.logger);s!==null?r?(u=s,this.logger.log(d.INFO,E.USER_RECEIVED_VARIABLE_VALUE,"OPTIMIZELY",u,i.key,e)):this.logger.log(d.INFO,E.FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",e,o,u):this.logger.log(d.INFO,E.VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",i.key,n.key)}else this.logger.log(d.INFO,E.USER_RECEIVED_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",o,i.key,e);return function(l,c,f){var p;switch(c){case M.BOOLEAN:l!=="true"&&l!=="false"?(f.log(d.ERROR,_.UNABLE_TO_CAST_VALUE,L,l,c),p=null):p=l==="true";break;case M.INTEGER:p=parseInt(l,10),isNaN(p)&&(f.log(d.ERROR,_.UNABLE_TO_CAST_VALUE,L,l,c),p=null);break;case M.DOUBLE:p=parseFloat(l),isNaN(p)&&(f.log(d.ERROR,_.UNABLE_TO_CAST_VALUE,L,l,c),p=null);break;case M.JSON:try{p=JSON.parse(l)}catch{f.log(d.ERROR,_.UNABLE_TO_CAST_VALUE,L,l,c),p=null}break;default:p=l}return p}(u,i.type,this.logger)},t.prototype.getFeatureVariableBoolean=function(e,r,n,i){try{return this.isValidInstance()?this.getFeatureVariableForType(e,r,M.BOOLEAN,n,i):(this.logger.log(d.ERROR,E.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableBoolean"),null)}catch(o){return this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o),null}},t.prototype.getFeatureVariableDouble=function(e,r,n,i){try{return this.isValidInstance()?this.getFeatureVariableForType(e,r,M.DOUBLE,n,i):(this.logger.log(d.ERROR,E.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableDouble"),null)}catch(o){return this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o),null}},t.prototype.getFeatureVariableInteger=function(e,r,n,i){try{return this.isValidInstance()?this.getFeatureVariableForType(e,r,M.INTEGER,n,i):(this.logger.log(d.ERROR,E.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableInteger"),null)}catch(o){return this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o),null}},t.prototype.getFeatureVariableString=function(e,r,n,i){try{return this.isValidInstance()?this.getFeatureVariableForType(e,r,M.STRING,n,i):(this.logger.log(d.ERROR,E.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableString"),null)}catch(o){return this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o),null}},t.prototype.getFeatureVariableJSON=function(e,r,n,i){try{return this.isValidInstance()?this.getFeatureVariableForType(e,r,M.JSON,n,i):(this.logger.log(d.ERROR,E.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableJSON"),null)}catch(o){return this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o),null}},t.prototype.getAllFeatureVariables=function(e,r,n){var i=this;try{if(!this.isValidInstance())return this.logger.log(d.ERROR,E.INVALID_OBJECT,"OPTIMIZELY","getAllFeatureVariables"),null;if(!this.validateInputs({feature_key:e,user_id:r},n))return null;var o=this.projectConfigManager.getConfig();if(!o)return null;var a=gt(o,e,this.logger);if(!a)return null;var u=this.createUserContext(r,n),s=this.decisionService.getVariationForFeature(o,a,u).result,l=Ve(s),c={};a.variables.forEach(function(p){c[p.key]=i.getFeatureVariableValueFromVariation(e,l,s.variation,p,r)});var f={};return s.decisionSource===S.FEATURE_TEST&&s.experiment!==null&&s.variation!==null&&(f={experimentKey:s.experiment.key,variationKey:s.variation.key}),this.notificationCenter.sendNotifications(w.DECISION,{type:Q.ALL_FEATURE_VARIABLES,userId:r,attributes:n||{},decisionInfo:{featureKey:e,featureEnabled:l,source:s.decisionSource,variableValues:c,sourceInfo:f}}),c}catch(p){return this.logger.log(d.ERROR,p.message),this.errorHandler.handleError(p),null}},t.prototype.getOptimizelyConfig=function(){try{return this.projectConfigManager.getConfig()?this.projectConfigManager.getOptimizelyConfig():null}catch(e){return this.logger.log(d.ERROR,e.message),this.errorHandler.handleError(e),null}},t.prototype.close=function(){var e=this;try{var r=this.eventProcessor.stop();return this.disposeOnUpdate&&(this.disposeOnUpdate(),this.disposeOnUpdate=null),this.projectConfigManager&&this.projectConfigManager.stop(),Object.keys(this.readyTimeouts).forEach(function(n){var i=e.readyTimeouts[n];clearTimeout(i.readyTimeout),i.onClose()}),this.readyTimeouts={},r.then(function(){return{success:!0}},function(n){return{success:!1,reason:String(n)}})}catch(n){return this.logger.log(d.ERROR,n.message),this.errorHandler.handleError(n),Promise.resolve({success:!1,reason:String(n)})}},t.prototype.onReady=function(e){var r,n,i=this;typeof e=="object"&&e!==null&&e.timeout!==void 0&&(r=e.timeout),h.isSafeInteger(r)||(r=3e4);var o=new Promise(function(s){n=s}),a=this.nextReadyTimeoutId;this.nextReadyTimeoutId++;var u=setTimeout(function(){delete i.readyTimeouts[a],n({success:!1,reason:I.sprintf("onReady timeout expired after %s ms",r)})},r);return this.readyTimeouts[a]={readyTimeout:u,onClose:function(){n({success:!1,reason:"Instance closed"})}},this.readyPromise.then(function(){clearTimeout(u),delete i.readyTimeouts[a],n({success:!0})}),Promise.race([this.readyPromise,o])},t.prototype.createUserContext=function(e,r){return this.validateInputs({user_id:e},r)?new Ro({optimizely:this,userId:e,attributes:r}):null},t.prototype.decide=function(e,r,n){var i,o,a,u,s=this;n===void 0&&(n=[]);var l,c=e.getUserId(),f=e.getAttributes(),p=this.projectConfigManager.getConfig(),g=[];if(!this.isValidInstance()||!p)return this.logger.log(d.INFO,E.INVALID_OBJECT,"OPTIMIZELY","decide"),Er(r,e,[Et.SDK_NOT_READY]);var y=p.featureKeyMap[r];if(!y)return this.logger.log(d.ERROR,_.FEATURE_NOT_IN_DATAFILE,"OPTIMIZELY",r),Er(r,e,[I.sprintf(Et.FLAG_KEY_INVALID,r)]);var m=this.getAllDecideOptions(n),R=this.decisionService.findValidatedForcedDecision(p,e,r);g.push.apply(g,R.reasons);var C=R.result;if(C)l={experiment:null,variation:C,decisionSource:S.FEATURE_TEST};else{var x=this.decisionService.getVariationForFeature(p,y,e,m);g.push.apply(g,x.reasons),l=x.result}var V=l.decisionSource,P=(o=(i=l.experiment)===null||i===void 0?void 0:i.key)!==null&&o!==void 0?o:null,W=(u=(a=l.variation)===null||a===void 0?void 0:a.key)!==null&&u!==void 0?u:null,Y=Ve(l);Y===!0?this.logger.log(d.INFO,E.FEATURE_ENABLED_FOR_USER,"OPTIMIZELY",r,c):this.logger.log(d.INFO,E.FEATURE_NOT_ENABLED_FOR_USER,"OPTIMIZELY",r,c);var Ut={},hn=!1;m[H.EXCLUDE_VARIABLES]||y.variables.forEach(function(_e){Ut[_e.key]=s.getFeatureVariableValueFromVariation(r,Y,l.variation,_e,c)}),!m[H.DISABLE_DECISION_EVENT]&&(V===S.FEATURE_TEST||V===S.ROLLOUT&&Or(p))&&(this.sendImpressionEvent(l,r,c,Y,f),hn=!0);var bt=[];m[H.INCLUDE_REASONS]&&(bt=g.map(function(_e){return I.sprintf.apply(void 0,ft([_e[0]],_e.slice(1)))}));var Da={flagKey:r,enabled:Y,variationKey:W,ruleKey:P,variables:Ut,reasons:bt,decisionEventDispatched:hn};return this.notificationCenter.sendNotifications(w.DECISION,{type:Q.FLAG,userId:c,attributes:f,decisionInfo:Da}),{variationKey:W,enabled:Y,variables:Ut,ruleKey:P,flagKey:r,userContext:e,reasons:bt}},t.prototype.getAllDecideOptions=function(e){var r=this,n=Z({},this.defaultDecideOptions);return Array.isArray(e)?e.forEach(function(i){H[i]?n[i]=!0:r.logger.log(d.WARNING,E.UNRECOGNIZED_DECIDE_OPTION,"OPTIMIZELY",i)}):this.logger.log(d.DEBUG,E.INVALID_DECIDE_OPTIONS,"OPTIMIZELY"),n},t.prototype.decideForKeys=function(e,r,n){var i=this;n===void 0&&(n=[]);var o={};if(!this.isValidInstance())return this.logger.log(d.ERROR,E.INVALID_OBJECT,"OPTIMIZELY","decideForKeys"),o;if(r.length===0)return o;var a=this.getAllDecideOptions(n);return r.forEach(function(u){var s=i.decide(e,u,n);a[H.ENABLED_FLAGS_ONLY]&&!s.enabled||(o[u]=s)}),o},t.prototype.decideAll=function(e,r){r===void 0&&(r=[]);var n=this.projectConfigManager.getConfig();if(!this.isValidInstance()||!n)return this.logger.log(d.ERROR,E.INVALID_OBJECT,"OPTIMIZELY","decideAll"),{};var i=Object.keys(n.featureKeyMap);return this.decideForKeys(e,i,r)},t}(),ko=function(t){return!(typeof t!="number"||!h.isSafeInteger(t))&&t>=1},wo=function(t){return!(typeof t!="number"||!h.isSafeInteger(t))&&t>0},Bo=function(){function t(e){var r=this;this.logger=e.logger,this.errorHandler=e.errorHandler,this.notificationListeners={},I.objectValues(w).forEach(function(n){r.notificationListeners[n]=[]}),this.listenerId=1}return t.prototype.addNotificationListener=function(e,r){try{if(!(I.objectValues(w).indexOf(e)>-1))return-1;this.notificationListeners[e]||(this.notificationListeners[e]=[]);var n=!1;if((this.notificationListeners[e]||[]).forEach(function(o){o.callback!==r||(n=!0)}),n)return-1;this.notificationListeners[e].push({id:this.listenerId,callback:r});var i=this.listenerId;return this.listenerId+=1,i}catch(o){return this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o),-1}},t.prototype.removeNotificationListener=function(e){var r=this;try{var n,i;if(Object.keys(this.notificationListeners).some(function(o){return(r.notificationListeners[o]||[]).every(function(a,u){return a.id!==e||(n=u,i=o,!1)}),n!==void 0&&i!==void 0}),n!==void 0&&i!==void 0)return this.notificationListeners[i].splice(n,1),!0}catch(o){this.logger.log(d.ERROR,o.message),this.errorHandler.handleError(o)}return!1},t.prototype.clearAllNotificationListeners=function(){var e=this;try{I.objectValues(w).forEach(function(r){e.notificationListeners[r]=[]})}catch(r){this.logger.log(d.ERROR,r.message),this.errorHandler.handleError(r)}},t.prototype.clearNotificationListeners=function(e){try{this.notificationListeners[e]=[]}catch(r){this.logger.log(d.ERROR,r.message),this.errorHandler.handleError(r)}},t.prototype.sendNotifications=function(e,r){var n=this;try{(this.notificationListeners[e]||[]).forEach(function(i){var o=i.callback;try{o(r)}catch(a){n.logger.log(d.ERROR,E.NOTIFICATION_LISTENER_EXCEPTION,"NOTIFICATION_CENTER",e,a.message)}})}catch(i){this.logger.log(d.ERROR,i.message),this.errorHandler.handleError(i)}},t}(),Ko={createEventProcessor:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new(ce.LogTierV1EventProcessor.bind.apply(ce.LogTierV1EventProcessor,ft([void 0],t)))},LocalStoragePendingEventsDispatcher:ce.LocalStoragePendingEventsDispatcher};function jo(t,e,r,n){var i={sdkKey:t};if((n===void 0||typeof n=="object"&&n!==null)&&h.assign(i,n),r){var o=Rr({datafile:r,jsonSchemaValidator:void 0,logger:e}),a=o.configObj,u=o.error;u&&e.error(u),a&&(i.datafile=mr(a))}return new po(i)}var X=O.getLogger();O.setLogHandler(fr()),O.setLogLevel(O.LogLevel.INFO);var yt=!1,Go=function(t){try{t.errorHandler&&O.setErrorHandler(t.errorHandler),t.logger&&(O.setLogHandler(t.logger),O.setLogLevel(O.LogLevel.NOTSET)),t.logLevel!==void 0&&O.setLogLevel(t.logLevel);try{ho(t),t.isValidInstance=!0}catch(c){X.error(c),t.isValidInstance=!1}var e=void 0;t.eventDispatcher==null?(e=new ce.LocalStoragePendingEventsDispatcher({eventDispatcher:lr}),yt||(e.sendPendingEvents(),yt=!0)):e=t.eventDispatcher;var r=t.eventBatchSize,n=t.eventFlushInterval;ko(t.eventBatchSize)||(X.warn("Invalid eventBatchSize %s, defaulting to %s",t.eventBatchSize,10),r=10),wo(t.eventFlushInterval)||(X.warn("Invalid eventFlushInterval %s, defaulting to %s",t.eventFlushInterval,1e3),n=1e3);var i=O.getErrorHandler(),o=new Bo({logger:X,errorHandler:i}),a={dispatcher:e,flushInterval:n,batchSize:r,maxQueueSize:t.eventMaxQueueSize||1e4,notificationCenter:o},u=Z(Z({clientEngine:"javascript-sdk"},t),{eventProcessor:Ko.createEventProcessor(a),logger:X,errorHandler:i,datafileManager:t.sdkKey?jo(t.sdkKey,X,t.datafile,t.datafileOptions):void 0,notificationCenter:o}),s=new xo(u);try{if(typeof window.addEventListener=="function"){var l="onpagehide"in window?"pagehide":"unload";window.addEventListener(l,function(){s.close()},!1)}}catch(c){X.error(E.UNABLE_TO_ATTACH_UNLOAD,"INDEX_BROWSER",c.message)}return s}catch(c){return X.error(c),null}},Ho=function(){yt=!1},mt={logging:mo,errorHandler:Io,eventDispatcher:lr,enums:go,setLogger:O.setLogHandler,setLogLevel:O.setLogLevel,createInstance:Go,__internalResetRetryState:Ho,OptimizelyDecideOption:H},Yo=Object.defineProperty,Pe=(t,e)=>Yo(t,"name",{value:e,configurable:!0});const qo={handleError(t){Hr(t)}};function Kr(){var t;jr();const e=(t=document.head.querySelector("meta[name=optimizely-datafile]"))==null?void 0:t.content;return mt.createInstance({datafile:e,errorHandler:qo})}Pe(Kr,"createInstance");function jr(){const t=Gr("optimizely.logLevel");t?mt.setLogLevel(t):mt.setLogger(null)}Pe(jr,"configureLogger");function Gr(t){var e;try{return(e=window.localStorage)==null?void 0:e.getItem(t)}catch{return null}}Pe(Gr,"localStorage");async function Hr(t){var e,r;const n=(r=(e=document.head)==null?void 0:e.querySelector('meta[name="browser-optimizely-client-errors-url"]'))==null?void 0:r.content;if(!n)return;const i={message:t.message,stack:t.stack,stacktrace:$e(t),sanitizedUrl:qe()||window.location.href,user:ze()||void 0};try{await fetch(n,{method:"post",body:JSON.stringify(i)})}catch{}}Pe(Hr,"reportError");var $o=Object.defineProperty,Me=(t,e)=>$o(t,"name",{value:e,configurable:!0});function Fe(t){const e=[];for(const r of Yr()){const[n,i]=r.trim().split("=");t===n&&typeof i!="undefined"&&e.push({key:n,value:i})}return e}Me(Fe,"getCookies");function Yr(){try{return document.cookie.split(";")}catch{return[]}}Me(Yr,"readCookies");function zo(t,e,r=null,n=!1,i="lax"){let o=document.domain;if(o==null)throw new Error("Unable to get document domain");o.endsWith(".github.com")&&(o="github.com");const a=location.protocol==="https:"?"; secure":"",u=r?`; expires=${r}`:"";n===!1&&(o=`.${o}`);try{document.cookie=`${t}=${e}; path=/; domain=${o}${u}${a}; samesite=${i}`}catch{}}Me(zo,"setCookie");function Xo(t,e=!1){let r=document.domain;if(r==null)throw new Error("Unable to get document domain");r.endsWith(".github.com")&&(r="github.com");const n=new Date().getTime(),i=new Date(n-1).toUTCString(),o=location.protocol==="https:"?"; secure":"",a=`; expires=${i}`;e===!1&&(r=`.${r}`);try{document.cookie=`${t}=''; path=/; domain=${r}${a}${o}`}catch{}}Me(Xo,"deleteCookie");function b(){if(!(this instanceof b))return new b;this.size=0,this.uid=0,this.selectors=[],this.indexes=Object.create(this.indexes),this.activeIndexes=[]}var ge=window.document.documentElement,Wo=ge.matches||ge.webkitMatchesSelector||ge.mozMatchesSelector||ge.oMatchesSelector||ge.msMatchesSelector;b.prototype.matchesSelector=function(t,e){return Wo.call(t,e)},b.prototype.querySelectorAll=function(t,e){return e.querySelectorAll(t)},b.prototype.indexes=[];var Jo=/^#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;b.prototype.indexes.push({name:"ID",selector:function(e){var r;if(r=e.match(Jo))return r[0].slice(1)},element:function(e){if(e.id)return[e.id]}});var Zo=/^\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;b.prototype.indexes.push({name:"CLASS",selector:function(e){var r;if(r=e.match(Zo))return r[0].slice(1)},element:function(e){var r=e.className;if(r){if(typeof r=="string")return r.split(/\s/);if(typeof r=="object"&&"baseVal"in r)return r.baseVal.split(/\s/)}}});var Qo=/^((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;b.prototype.indexes.push({name:"TAG",selector:function(e){var r;if(r=e.match(Qo))return r[0].toUpperCase()},element:function(e){return[e.nodeName.toUpperCase()]}}),b.prototype.indexes.default={name:"UNIVERSAL",selector:function(){return!0},element:function(){return[!0]}};var Rt;typeof window.Map=="function"?Rt=window.Map:Rt=function(){function t(){this.map={}}return t.prototype.get=function(e){return this.map[e+" "]},t.prototype.set=function(e,r){this.map[e+" "]=r},t}();var qr=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g;function $r(t,e){t=t.slice(0).concat(t.default);var r=t.length,n,i,o,a,u=e,s,l,c=[];do if(qr.exec(""),(o=qr.exec(u))&&(u=o[3],o[2]||!u)){for(n=0;n<r;n++)if(l=t[n],s=l.selector(o[1])){for(i=c.length,a=!1;i--;)if(c[i].index===l&&c[i].key===s){a=!0;break}a||c.push({index:l,key:s});break}}while(o);return c}function ea(t,e){var r,n,i;for(r=0,n=t.length;r<n;r++)if(i=t[r],e.isPrototypeOf(i))return i}b.prototype.logDefaultIndexUsed=function(){},b.prototype.add=function(t,e){var r,n,i,o,a,u,s,l,c=this.activeIndexes,f=this.selectors;if(typeof t=="string"){for(r={id:this.uid++,selector:t,data:e},s=$r(this.indexes,t),n=0;n<s.length;n++)l=s[n],o=l.key,i=l.index,a=ea(c,i),a||(a=Object.create(i),a.map=new Rt,c.push(a)),i===this.indexes.default&&this.logDefaultIndexUsed(r),u=a.map.get(o),u||(u=[],a.map.set(o,u)),u.push(r);this.size++,f.push(t)}},b.prototype.remove=function(t,e){if(typeof t=="string"){var r,n,i,o,a,u,s,l,c=this.activeIndexes,f={},p=arguments.length===1;for(r=$r(this.indexes,t),i=0;i<r.length;i++)for(n=r[i],o=c.length;o--;)if(u=c[o],n.index.isPrototypeOf(u)){if(s=u.map.get(n.key),s)for(a=s.length;a--;)l=s[a],l.selector===t&&(p||l.data===e)&&(s.splice(a,1),f[l.id]=!0);break}this.size-=Object.keys(f).length}};function zr(t,e){return t.id-e.id}b.prototype.queryAll=function(t){if(!this.selectors.length)return[];var e={},r=[],n=this.querySelectorAll(this.selectors.join(", "),t),i,o,a,u,s,l,c,f;for(i=0,a=n.length;i<a;i++)for(s=n[i],l=this.matches(s),o=0,u=l.length;o<u;o++)f=l[o],e[f.id]?c=e[f.id]:(c={id:f.id,selector:f.selector,data:f.data,elements:[]},e[f.id]=c,r.push(c)),c.elements.push(s);return r.sort(zr)},b.prototype.matches=function(t){if(!t)return[];var e,r,n,i,o,a,u,s,l,c,f,p=this.activeIndexes,g={},y=[];for(e=0,i=p.length;e<i;e++)if(u=p[e],s=u.element(t),s){for(r=0,o=s.length;r<o;r++)if(l=u.map.get(s[r]))for(n=0,a=l.length;n<a;n++)c=l[n],f=c.id,!g[f]&&this.matchesSelector(t,c.selector)&&(g[f]=!0,y.push(c))}return y.sort(zr)};var xe=null,Ot=null,Tt=[];function Xr(t,e){var r=[];function n(){var o=r;r=[],e(o)}function i(){for(var o=arguments.length,a=Array(o),u=0;u<o;u++)a[u]=arguments[u];r.push(a),r.length===1&&Nt(t,n)}return i}function Nt(t,e){Ot||(Ot=new MutationObserver(ta)),xe||(xe=t.createElement("div"),Ot.observe(xe,{attributes:!0})),Tt.push(e),xe.setAttribute("data-twiddle",""+Date.now())}function ta(){var t=Tt;Tt=[];for(var e=0;e<t.length;e++)try{t[e]()}catch(r){setTimeout(function(){throw r},0)}}var Wr=new WeakMap,ve=new WeakMap,ke=new WeakMap,te=new WeakMap;function we(t,e){for(var r=0;r<e.length;r++){var n=e[r],i=n[0],o=n[1],a=n[2];i===Be?(ra(a,o),na(a,o)):i===Qr?Jr(a,o):i===Ke&&ia(t.observers,o)}}function ra(t,e){if(e instanceof t.elementConstructor){var r=Wr.get(e);if(r||(r=[],Wr.set(e,r)),r.indexOf(t.id)===-1){var n=void 0;if(t.initialize&&(n=t.initialize.call(void 0,e)),n){var i=ve.get(e);i||(i={},ve.set(e,i)),i[""+t.id]=n}r.push(t.id)}}}function na(t,e){if(e instanceof t.elementConstructor){var r=te.get(e);if(r||(r=[],te.set(e,r)),r.indexOf(t.id)===-1){t.elements.push(e);var n=ve.get(e),i=n?n[""+t.id]:null;if(i&&i.add&&i.add.call(void 0,e),t.subscribe){var o=t.subscribe.call(void 0,e);if(o){var a=ke.get(e);a||(a={},ke.set(e,a)),a[""+t.id]=o}}t.add&&t.add.call(void 0,e),r.push(t.id)}}}function Jr(t,e){if(e instanceof t.elementConstructor){var r=te.get(e);if(!!r){var n=t.elements.indexOf(e);if(n!==-1&&t.elements.splice(n,1),n=r.indexOf(t.id),n!==-1){var i=ve.get(e),o=i?i[""+t.id]:null;if(o&&o.remove&&o.remove.call(void 0,e),t.subscribe){var a=ke.get(e),u=a?a[""+t.id]:null;u&&u.unsubscribe&&u.unsubscribe()}t.remove&&t.remove.call(void 0,e),r.splice(n,1)}r.length===0&&te.delete(e)}}}function ia(t,e){var r=te.get(e);if(!!r){for(var n=r.slice(0),i=0;i<n.length;i++){var o=t[n[i]];if(!!o){var a=o.elements.indexOf(e);a!==-1&&o.elements.splice(a,1);var u=ve.get(e),s=u?u[""+o.id]:null;s&&s.remove&&s.remove.call(void 0,e);var l=ke.get(e),c=l?l[""+o.id]:null;c&&c.unsubscribe&&c.unsubscribe(),o.remove&&o.remove.call(void 0,e)}}te.delete(e)}}var At=null;function oa(t){if(At===null){var e=t.createElement("div"),r=t.createElement("div"),n=t.createElement("div");e.appendChild(r),r.appendChild(n),e.innerHTML="",At=n.parentNode!==r}return At}function Zr(t){return"matches"in t||"webkitMatchesSelector"in t||"mozMatchesSelector"in t||"oMatchesSelector"in t||"msMatchesSelector"in t}var Be=1,Qr=2,Ke=3;function aa(t,e,r){for(var n=0;n<r.length;n++){var i=r[n];i.type==="childList"?(en(t,e,i.addedNodes),sa(t,e,i.removedNodes)):i.type==="attributes"&&je(t,e,i.target)}oa(t.ownerDocument)&&ca(t,e)}function en(t,e,r){for(var n=0;n<r.length;n++){var i=r[n];if(Zr(i))for(var o=t.selectorSet.matches(i),a=0;a<o.length;a++){var u=o[a].data;e.push([Be,i,u])}if("querySelectorAll"in i)for(var s=t.selectorSet.queryAll(i),l=0;l<s.length;l++)for(var c=s[l],f=c.data,p=c.elements,g=0;g<p.length;g++)e.push([Be,p[g],f])}}function sa(t,e,r){for(var n=0;n<r.length;n++){var i=r[n];if("querySelectorAll"in i){e.push([Ke,i]);for(var o=i.querySelectorAll("*"),a=0;a<o.length;a++)e.push([Ke,o[a]])}}}function je(t,e,r){if(Zr(r))for(var n=t.selectorSet.matches(r),i=0;i<n.length;i++){var o=n[i].data;e.push([Be,r,o])}if("querySelectorAll"in r){var a=te.get(r);if(a)for(var u=0;u<a.length;u++){var s=t.observers[a[u]];s&&(t.selectorSet.matchesSelector(r,s.selector)||e.push([Qr,r,s]))}}}function ua(t,e,r){if("querySelectorAll"in r){je(t,e,r);for(var n=r.querySelectorAll("*"),i=0;i<n.length;i++)je(t,e,n[i])}}function la(t,e,r){for(var n=0;n<r.length;n++)for(var i=r[n],o=i.form?i.form.elements:t.rootNode.querySelectorAll("input"),a=0;a<o.length;a++)je(t,e,o[a])}function ca(t,e){for(var r=0;r<t.observers.length;r++){var n=t.observers[r];if(n)for(var i=n.elements,o=0;o<i.length;o++){var a=i[o];a.parentNode||e.push([Ke,a])}}}function fa(t,e){var r=t.readyState;r==="interactive"||r==="complete"?Nt(t,e):t.addEventListener("DOMContentLoaded",Nt(t,e))}var da=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ea=0;function he(t){this.rootNode=t.nodeType===9?t.documentElement:t,this.ownerDocument=t.nodeType===9?t:t.ownerDocument,this.observers=[],this.selectorSet=new b,this.mutationObserver=new MutationObserver(va.bind(this,this)),this._scheduleAddRootNodes=Xr(this.ownerDocument,ga.bind(this,this)),this._handleThrottledChangedTargets=Xr(this.ownerDocument,_a.bind(this,this)),this.rootNode.addEventListener("change",ha.bind(this,this),!1),fa(this.ownerDocument,pa.bind(this,this))}he.prototype.disconnect=function(){this.mutationObserver.disconnect()},he.prototype.observe=function(t,e){var r=void 0;typeof e=="function"?r={selector:t,initialize:e}:(typeof e=="undefined"?"undefined":da(e))==="object"?(r=e,r.selector=t):r=t;var n=this,i={id:Ea++,selector:r.selector,initialize:r.initialize,add:r.add,remove:r.remove,subscribe:r.subscribe,elements:[],elementConstructor:r.hasOwnProperty("constructor")?r.constructor:this.ownerDocument.defaultView.Element,abort:function(){n._abortObserving(i)}};return this.selectorSet.add(i.selector,i),this.observers[i.id]=i,this._scheduleAddRootNodes(),i},he.prototype._abortObserving=function(t){for(var e=t.elements,r=0;r<e.length;r++)Jr(t,e[r]);this.selectorSet.remove(t.selector,t),delete this.observers[t.id]},he.prototype.triggerObservers=function(t){var e=[];ua(this,e,t),we(this,e)};function pa(t){t.mutationObserver.observe(t.rootNode,{childList:!0,attributes:!0,subtree:!0}),t._scheduleAddRootNodes()}function ga(t){var e=[];en(t,e,[t.rootNode]),we(t,e)}function va(t,e){var r=[];aa(t,r,e),we(t,r)}function ha(t,e){t._handleThrottledChangedTargets(e.target)}function _a(t,e){var r=[];la(t,r,e),we(t,r)}var St=void 0;function Ia(){return St||(St=new he(window.document)),St}function ya(){var t;return(t=Ia()).observe.apply(t,arguments)}var tn={},rn={},Lt=new WeakMap,nn=new WeakMap,Dt=new WeakMap,on=Object.getOwnPropertyDescriptor(Event.prototype,"currentTarget");function an(t,e,r){var n=t[e];return t[e]=function(){return r.apply(t,arguments),n.apply(t,arguments)},t}function ma(t,e,r){var n=[],i=e;do{if(i.nodeType!==1)break;var o=t.matches(i);if(o.length){var a={node:i,observers:o};r?n.unshift(a):n.push(a)}}while(i=i.parentElement);return n}function Ra(){Lt.set(this,!0)}function Oa(){Lt.set(this,!0),nn.set(this,!0)}function Ta(){return Dt.get(this)||null}function sn(t,e){!on||Object.defineProperty(t,"currentTarget",{configurable:!0,enumerable:!0,get:e||on.get})}function Na(t){try{return t.eventPhase,!0}catch{return!1}}function Aa(t){if(!!Na(t)){var e=t.eventPhase===1?rn:tn,r=e[t.type];if(!!r){var n=ma(r,t.target,t.eventPhase===1);if(!!n.length){an(t,"stopPropagation",Ra),an(t,"stopImmediatePropagation",Oa),sn(t,Ta);for(var i=0,o=n.length;i<o&&!Lt.get(t);i++){var a=n[i];Dt.set(t,a.node);for(var u=0,s=a.observers.length;u<s&&!nn.get(t);u++)a.observers[u].data.call(a.node,t)}Dt.delete(t),sn(t)}}}}function un(t,e,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},i=!!n.capture,o=i?rn:tn,a=o[t];a||(a=new b,o[t]=a,document.addEventListener(t,Aa,i)),a.add(e,r)}var Sa=Object.defineProperty,ae=(t,e)=>Sa(t,"name",{value:e,configurable:!0}),ln,cn;let N;(async function(){N=Kr(),await N.onReady()})();function fn(t){return t.toLowerCase().replace(/-(.)/g,function(e,r){return r.toUpperCase()})}ae(fn,"camelCase");function Ge(t){const e={};for(const{name:r,value:n}of t.attributes)if(r.startsWith("data-optimizely-meta-")){const i=r.replace("data-optimizely-meta-","");n&&n.trim().length&&(e[fn(i)]=n)}return e}ae(Ge,"getUserAttributes"),un("click","[data-optimizely-event]",function(t){if(!N)return;const e=t.currentTarget,r=e.getAttribute("data-optimizely-event")||"",[n,i]=r.trim().split(/\s*,\s*/),o=Ge(e);n&&i?N.track(n,i,o):n&&N.track(n,q(),o)}),ya("[data-optimizely-experiment]",t=>{if(!N)return;const e=t.getAttribute("data-optimizely-experiment");if(!e||t.hidden)return;const r=Ge(t),n=N.activate(e,q(),r);if(!n)return;const i=t.querySelectorAll("[data-optimizely-variation]");for(const o of i){const a=o.getAttribute("data-optimizely-variation");o.hidden=a!==n}});const La=((cn=(ln=document.querySelector('meta[name="enabled-homepage-translation-languages"]'))==null?void 0:ln.getAttribute("content"))==null?void 0:cn.split(","))||[],dn=Fe("_locale_experiment").length>0&&Fe("_locale_experiment")[0].value==="ko"&&La.includes("ko");dn&&window.location.pathname==="/"&&En(),dn&&window.location.pathname==="/join"&&pn();async function En(){var t,e;const r="ko_homepage_translation",n=q(),i=(e=(t=Fe("_locale")[0])==null?void 0:t.value)==null?void 0:e.slice(0,2);N.setForcedVariation(r,n,i),N.activate(r,n);const o=document.querySelectorAll("[data-optimizely-variation]");for(const a of o)a.hidden=i!==a.getAttribute("data-optimizely-variation");for(const a of document.querySelectorAll('form[action^="/join"]'))a.addEventListener("submit",()=>{N.track("submit.homepage_signup",n)});for(const a of document.querySelectorAll('a[href^="/join"]'))a.addEventListener("click",()=>{N.track("click.homepage_signup",n)})}ae(En,"runKoreanHomepageExperiment");async function pn(){var t;(t=document.getElementById("signup-form"))==null||t.addEventListener("submit",()=>{const e="ko_homepage_translation",r=q();N.activate(e,r),N.track("submit.create_account",r)})}ae(pn,"trackSignupsFromKoreanHomepage");const se=document.querySelector('meta[name^="user-currency"]');se&&window.location.pathname==="/pricing"&&gn();async function gn(){var t,e,r;const n=((e=(t=document.querySelector('meta[name^="supported-currencies"]'))==null?void 0:t.getAttribute("content"))==null?void 0:e.split(","))||[],i="local_currency_pricing",o="view.pricing_page",a="usd",u="localized_currency",s=q(),l=(r=se==null?void 0:se.getAttribute("content"))==null?void 0:r.toUpperCase(),c=new URLSearchParams(window.location.search);if(l==="USD"||!l||!n.includes(l))return;c.has("currency")&&N.setForcedVariation(i,s,u);const p=N.activate(i,s)===a?"USD":l;N.track(o,s,{requestedCurrency:l});for(const g of document.querySelectorAll("[data-currency]"))g.hidden=g.getAttribute("data-currency")!==p}ae(gn,"runCurrencyExperiment"),un("click","#signup_button",function(){var t,e;if(!N||!se)return;const r=new URLSearchParams(document.location.href);if(!(r.get("pricing_exp")&&((t=r.get("ref_page"))==null?void 0:t.startsWith("/pricing"))))return;const i="submit.create_account",o=(e=se==null?void 0:se.getAttribute("content"))==null?void 0:e.toUpperCase();N.track(i,q(),{requestedCurrency:o})}),vn();async function vn(){if(!N)return;const t=q();N.activate("test_experiment",t),N.track("test_event",t)}return ae(vn,"runTestExperiment"),He.getUserAttributes=Ge,Object.defineProperty(He,"__esModule",{value:!0}),He})({});
//# sourceMappingURL=optimizely-0997cdaa.js.map
